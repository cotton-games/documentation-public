# Repo `pro` ‚Äî Tasks

## PATCH ADMIN ‚Äî Certification communaut√© -> Cotton + onglet Quiz `Lots temporaires` [2026-02-27]
- [x] Audit cibl√© (proof-first) :
  - biblioth√®que list/view/script :
    - `pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_list.php`
    - `pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_view.php`
    - `pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_script.php`
    - `pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_lib.php`
  - sources statut/auteur :
    - `pro/web/ec/modules/jeux/bibliotheque/sources/quiz_series.php`
    - `pro/web/ec/modules/jeux/bibliotheque/sources/playlists.php`
  - flux session quiz lots temporaires :
    - `pro/web/ec/modules/tunnel/start/ec_start_sessions_view.php`
    - `global/web/app/modules/jeux/cotton_quiz/app_cotton_quiz_functions.php`
- [x] A ‚Äî Certifier un contenu communautaire (admin only) :
  - ajout action explicite `Certifier ce contenu` en view biblioth√®que pour admin sur onglet `Communaut√©`
  - ajout backend `content_library_admin_certify` + garde stricte admin (`id_client=10`)
  - promotion vers `Cotton` sans √©craser l‚Äôauteur :
    - auteur source conserv√© (`id_client_auteur` / `nom_auteur` inchang√©s)
    - mise √† jour publication source (`id_etat=2` quiz / `online=1` playlists)
    - bascule des r√©f√©rences `community_items.origin` vers `cotton` (+ publication forc√©e)
    - exclusion explicite du filtre `Communaut√©` apr√®s promotion (m√™me en fallback admin): filtre SQL `NOT EXISTS` sur `community_items.origin='cotton'`
  - tra√ßabilit√© : log `CONTENT_CERTIFIED_BY_ADMIN`
- [x] B ‚Äî Biblioth√®que Quiz : onglet admin-only `Lots temporaires` :
  - ajout du type de vue `temp_lots` c√¥t√© list (visible uniquement admin + quiz)
  - source d√©di√©e `clib_quiz_temp_lots_admin_list_get(...)` :
    - lots `questions_lots_temp`
    - filtre auto-g√©n√©r√© quiz papier : `descriptif_court LIKE 'S√©rie auto papier :%'`
    - reli√©s √† des sessions quiz papier (`id_type_produit in (1,5)`, `flag_controle_numerique=0`) via token `T{id}` dans `lot_ids`
  - navigation list -> view temp lot en mode biblioth√®que admin (sans imposer le contexte session agenda)
  - maintenance question limit√©e admin :
    - backend : nouveau mode `content_library_temp_lot_question_update` (admin-only) + refus URL directe non-admin
    - backend : garde lot maintenable (`descriptif_court` auto papier + session quiz papier li√©e via token `T{id}`)
    - view admin biblioth√®que : formulaire d‚Äô√©dition pr√©rempli (pas de workflow A/B remplacement)
    - UI fiche session agenda : libell√© `Voir / Modifier` conserv√© uniquement pour admin
  - recadrage ‚Äúcatalogue admin‚Äù (non-agenda) :
    - liens list `temp_lots` sans `context=session` ni `nav_ctx=agenda`
    - neutralisation du bandeau session/retour session en contexte admin biblioth√®que
    - bloc `Sessions li√©es` filtr√© hors d√©mos (`flag_session_demo=0`) et conserv√© en lecture seule informative
    - modale admin: affichage explicite des supports actuels (liens existants question/r√©ponse)
  - CTA/admin view temp lot :
    - suppression du CTA principal ‚Äúretour session‚Äù en contexte biblioth√®que admin
    - ajout CTA `Lancer une d√©mo` (duplication de session li√©e) + affichage informatif des sessions li√©es
- [x] V√©rifications techniques :
  - `php -l pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_lib.php` OK
  - `php -l pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_script.php` OK
  - `php -l pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_list.php` OK
  - `php -l pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_view.php` OK
  - `php -l pro/web/ec/modules/tunnel/start/ec_start_sessions_view.php` OK
  - `php -l pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_lib.php` OK (post-fix filtre communaut√©)
- [ ] QA manuelle :
  - admin : onglet `Communaut√©` -> action `Certifier ce contenu` visible et fonctionnelle
  - non-admin : aucune action de certification
  - apr√®s certification : contenu visible en onglet `Cotton` pour un utilisateur standard
  - auteur initial conserv√©/affich√© apr√®s certification
  - admin quiz : onglet `Lots temporaires` visible
  - non-admin quiz : onglet `Lots temporaires` absent
  - admin sur lot temporaire : d√©tail + correction question possibles
  - non-admin sur le m√™me flux : correction refus√©e (UI + backend)
  - non-r√©gression onglets standard (`Cotton`, `Communaut√©`, `Mes`) inchang√©s hors p√©rim√®tre

## PATCH PERM ‚Äî Biblioth√®que: bypass admin `id_client=10` √©tendu √† Cotton [2026-02-27]
- [x] Audit cibl√©:
  - point UI view: `pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_view.php`
  - points backend owner filters:
    - `pro/web/ec/modules/jeux/bibliotheque/sources/quiz_series.php`
    - `pro/web/ec/modules/jeux/bibliotheque/sources/playlists.php`
    - `pro/web/ec/modules/jeux/bibliotheque/sources/quiz_series_content.php`
    - `pro/web/ec/modules/jeux/bibliotheque/sources/playlists_content.php`
- [x] Patch minimal appliqu√©:
  - extension du bypass admin de `id_client_auteur>0` vers `id_client_auteur>=0`
  - impact: le compte admin (`id_client=10`) peut aussi modifier les th√©matiques Cotton (`id_client_auteur=0`) en plus des th√©matiques communaut√©
  - coh√©rence UI + backend:
    - affichage des actions de gestion en view
    - validations owner c√¥t√© save/update/delete + √©dition de contenu align√©es
- [x] V√©rifications techniques:
  - `php -l pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_view.php` OK
  - `php -l pro/web/ec/modules/jeux/bibliotheque/sources/quiz_series.php` OK
  - `php -l pro/web/ec/modules/jeux/bibliotheque/sources/playlists.php` OK
  - `php -l pro/web/ec/modules/jeux/bibliotheque/sources/quiz_series_content.php` OK
  - `php -l pro/web/ec/modules/jeux/bibliotheque/sources/playlists_content.php` OK
- [ ] QA manuelle:
  - admin `id_client=10` + onglet `Cotton` -> actions modifier/supprimer/√©diter contenu disponibles
  - admin `id_client=10` + onglet `Communaut√©` -> comportement existant conserv√©
  - compte non-admin -> aucun √©largissement de droits

## PATCH UX/Fonctionnel ‚Äî Biblioth√®que + Home + Agenda Quiz cibl√©s (2026-02-27)
- [x] Audit cibl√© (preuves code) des points A‚ÜíE:
  - `pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_lib.php`
  - `pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_list.php`
  - `pro/web/ec/modules/communication/home/ec_home_index.php`
  - `pro/web/ec/modules/tunnel/start/ec_start_agenda_mode.php`
  - `pro/web/ec/modules/tunnel/start/ec_start_sessions_view.php`
- [x] A ‚Äî Biblioth√®que list (`A la une`):
  - ajout du tag `En ce moment` (m√™me shape que `Populaire`, couleur d√©di√©e, libell√© d√©di√©) dans `ec_bibliotheque_list.php`
  - affichage conditionnel strict aux contenus `cotton` r√©ellement dans la fen√™tre ‚Äúen cours‚Äù (date courante)
  - source de v√©rit√© r√©utilis√©e depuis la logique existante `preset=now` de `ec_bibliotheque_lib.php` (`jour_associe_debut/fin`)
- [x] B ‚Äî Home INS CHR:
  - lien menu `Mon agenda` affich√© aussi pour INS+CHR m√™me si aucune session encore programm√©e (`ec.php`)
- [x] C ‚Äî Home INS/CSO particulier/√©v√©nement:
  - masquage du lien menu `Media Kit` pour:
    - INS particulier/√©v√©nement
    - CSO particulier/√©v√©nement
  - conservation du comportement CHR
- [x] D ‚Äî `start/agenda/mode` (quiz uniquement):
  - libell√© carte 1 quiz: description `4 s√©ries de quiz populaires...`
  - libell√© carte 2 quiz: titre `Choisir mes th√©matiques`
  - aucune modification bingo/blindtest
- [x] E ‚Äî Fiche d√©tail agenda quiz (s√©ries auto g√©n√©r√©es papier uniquement):
  - pour `T{id}` + quiz papier (`flag_controle_numerique=0`, `id_type_produit in (1,5)`):
    - bouton `Modifier cette s√©rie` masqu√©
    - bouton de suppression conserv√© (si suppression autoris√©e)
    - lien renomm√© `Voir / Modifier`
  - s√©ries classiques inchang√©es
- [x] F ‚Äî Suppression d‚Äôun slot Quiz V2 (temporaire `T` ou catalogue `L`):
  - correction serveur `session_quiz_slot_delete` pour parser et supprimer les slots sur la base des tokens r√©els `L/T` (ordre conserv√©)
  - √©vite la suppression de session provoqu√©e √† tort lors de la suppression d‚Äôun lot temporaire
  - reconstruction de `lot_ids` avec tokens restants (ex: `T..,L..`) + recalcul s√ªr de `id_produit`
- [x] G ‚Äî Fiche session agenda Blindtest/Bingo:
  - bouton `Remplacer` (playlist) harmonis√© en largeur compacte (`90px`) pour s‚Äôaligner visuellement avec les autres boutons d‚Äôaction de la page (`Modifier`, `Tester`, `Supprimer`)
- [x] H ‚Äî Remplacement d‚Äôune s√©rie Quiz V2 (hors lot temporaire):
  - correction serveur `session_theme` c√¥t√© `start_quiz_v2_apply_lots_to_session(...)` pour accepter les payloads tokenis√©s `L/T` (et pas uniquement des IDs num√©riques)
  - restauration du flux ‚ÄúRemplacer‚Äù slot par slot depuis la biblioth√®que sur les s√©ries quiz classiques
- [x] I ‚Äî Session mixte Quiz V2 (`T` + `L`) : remplacement d‚Äôun lot classique
  - correction de la r√©g√©n√©ration auto des lots papier: ne plus √©craser un payload mixte explicite (`T...`,`L...`) lors d‚Äôun `session_theme`
  - la r√©g√©n√©ration `qz_build_paper_auto_lot_ids_csv` reste active uniquement pour un cas de s√©lection simple (sans token `T`, payload mono-lot)
- [x] J ‚Äî Fiche session `start/game/view` (support papier, tous jeux):
  - harmonisation du libell√© des liens d‚Äôimpression en `Imprimer les feuilles de r√©ponses`
  - changement limit√© au texte visible (aucune modification des URLs d‚Äôimpression)
- [x] K ‚Äî Fix r√©gression agenda quick Quiz papier (lots temporaires absents) :
  - cause: `session_setting_multi` envoyait 4 lots catalogue (`4xL`) m√™me en mode papier, emp√™chant la r√©g√©n√©ration `T,T,T,L`
  - correctif: en agenda quick quiz papier (`session_flag_controle_numerique=0`), auto-pick ramen√© √† 1 lot catalogue avant `session_theme`
  - effet: `start_quiz_v2_apply_lots_to_session(...)` r√©g√©n√®re de nouveau les lots auto papier (`T,T,T,L`)
- [x] L ‚Äî Fix r√©gression remplacement questions lot temporaire (non-admin) :
  - cause: le recadrage admin a bascul√© toute la vue lot temporaire en mode √©dition admin + garde backend admin-only
  - correctif:
    - `clib_quiz_temp_lot_session_edit_context_get(...)` rouvre l‚Äôacc√®s session owner (non-admin) en contexte agenda/session quiz papier
    - `content_library_temp_lot_question_replace` n‚Äôimpose plus admin-only
    - split UI par contexte:
      - admin onglet `temp_lots` => √©dition (`‚úé`)
      - contexte session utilisateur => remplacement (`‚Üª`) avec modal A/B restaur√©e
- [x] M ‚Äî Fix format `jour_associe` sur cr√©ation/remplacement lot temporaire :
  - cause: √©criture au format `YYYY-MM-DD` dans `questions.jour_associe` alors que la colonne est en `char(5)` (`MM-DD`)
  - correctif:
    - normalisation explicite `jour_associe` avant √©criture DB (`MM-DD`) dans:
      - cr√©ation question de remplacement (flux client)
      - modification question existante (flux admin)
    - comparaison post-insert align√©e sur ce format DB normalis√©
- [x] N ‚Äî Fix r√©ouverture modale admin (propositions non affich√©es) :
  - cause: `clib_quiz_temp_lot_questions_get(...)` chargeait `questions.*` sans remapper `questions_propositions` dans `proposition_1..4`
  - correctif: enrichissement de `clib_quiz_temp_lot_questions_get(...)` avec chargement `questions_propositions` (ordre asc) et mapping vers `proposition_1..4`
- [x] O ‚Äî UI admin √©dition question lot temporaire : masquer `proposition_4` :
  - alignement avec le flux de remplacement existant (3 fausses propositions visibles)
  - retrait du champ `Prop. 4` du formulaire d‚Äô√©dition admin en view biblioth√®que
- [x] P ‚Äî UI admin √©dition question lot temporaire : afficher l‚ÄôURL du support actuel :
  - bloc `Support(s) actuel(s)` enrichi en `Support question : {url cliquable}`
  - objectif: lisibilit√© imm√©diate du lien support exact sans clic pr√©alable ambigu
- [x] Q ‚Äî List admin `Lots temporaires` : tri plus r√©cent -> plus ancien :
  - source `clib_quiz_temp_lots_admin_list_get(...)` tri√©e par cr√©ation lot (`t.date_ajout DESC, t.id DESC`)
  - objectif: afficher les lots les plus r√©cents en t√™te de l‚Äôonglet admin
- [x] R ‚Äî View admin `Lots temporaires` : suppression du badge de verrou d‚Äôusage :
  - la vue lot temporaire n‚Äôapplique plus le calcul de lock ‚Äúen cours d‚Äôutilisation par X clients‚Äù
  - suppression du bloc ‚ÄúModification et suppression temporairement impossible.‚Äù dans ce contexte
- [x] S ‚Äî CTA admin `Lancer une d√©mo` (lot temporaire) : d√©mo mono-lot d√©di√©e :
  - remplacement du flux `session_duplicate` (duplication d‚Äôune session li√©e compl√®te)
  - nouveau flux `content_library_temp_lot_demo` :
    - cr√©ation d‚Äôune session d√©mo quiz neuve (`session_init`)
    - affectation du seul lot temporaire courant via token `T{id}` (`session_theme`)
  - effet attendu: la d√©mo contient uniquement la s√©rie du lot temporaire consult√©
- [x] T ‚Äî Badge `Populaire` : scope limit√© aux lots catalogue `L` :
  - exclusion explicite de l‚Äôonglet admin `Lots temporaires` du calcul/rendu `Populaire`
  - la popularit√© reste calcul√©e via la table stats catalogue pour les onglets `Cotton`, `Communaut√©`, `Mes` (s√©ries/playlists `L`)
- [x] U ‚Äî Quiz `A la une` align√© sur ‚Äúth√©matiques du moment‚Äù + badge `En ce moment` :
  - en `preset=now` + `type=cotton`, priorit√© SQL sur la fen√™tre date `jour_associe_debut/fin` aussi pour Quiz
  - s√©lection des champs `jour_associe_debut/fin` activ√©e en list Quiz
  - rendu badge `En ce moment` activ√© sur les s√©ries Quiz selon la m√™me r√®gle que les playlists
- [x] V ‚Äî Biblioth√®que list: pagination responsive mobile :
  - ajout d‚Äôun wrapper pagination d√©di√© (`clib-pagination-wrap`) avec scroll horizontal sur petit √©cran
  - pagination mobile non bloquante:
    - conservation des num√©ros de page
    - suppression du d√©bordement via `overflow-x:auto` + `width:max-content`
  - desktop conserv√© (wrap centr√©) sans changement de comportement fonctionnel
- [x] W ‚Äî Biblioth√®que quiz: usage des lots temporaires `T` distinct de `L` :
  - cause: le calcul `clib_usage_get(...)` pouvait croiser des usages catalogue (`L{id}`) quand la card affich√©e √©tait un lot temporaire (`T{id}`)
  - correctif:
    - `clib_usage_get(...)` accepte un mode lot quiz (`L|T`, d√©faut `L`)
    - mode `T`: filtrage strict sur `id_type_produit=5` + pr√©sence token `T{id}` dans `lot_ids` (sans fallback `id_produit` ni `community_items`)
    - list biblioth√®que onglet `temp_lots`: appel explicite en mode `T`
  - effet: la ligne `Jou√©e X fois` des cards `Lots temporaires` ne remonte plus les usages des lots catalogue de m√™me id num√©rique
- [x] X ‚Äî Bypass admin lock usage actif (th√©matiques Cotton/Communaut√©) :
  - objectif: autoriser le compte admin (`id_client=10`) √† modifier/supprimer m√™me quand une th√©matique est en cours d‚Äôutilisation, sans changer le comportement non-admin
  - backend:
    - `clib_content_edit_or_delete_allowed(...)` laisse passer l‚Äôadmin m√™me si `session_count>0`
    - journalisation d√©di√©e des bypass admin: `CONTENT_EDIT_ADMIN_BYPASS_IN_USE` / `CONTENT_DELETE_ADMIN_BYPASS_IN_USE`
  - view:
    - conservation du bandeau d‚Äôinformation d‚Äôusage actif
    - d√©verrouillage des actions d‚Äô√©dition/suppression pour admin (plus de blocage UI)
    - non-admin inchang√© (th√©matiques perso toujours bloqu√©es si en cours d‚Äôutilisation)
- [x] Y ‚Äî Fix r√©gression √©dition meta admin: s√©rie Cotton masqu√©e (`community_items.status=hidden`) :
  - cause: le formulaire d‚Äô√©dition meta envoyait `flag_share_community=0` en contexte admin non-owner, ce qui d√©clenchait l‚Äôarchive logique (`status=hidden`) c√¥t√© `community_items`
  - correctif:
    - `editor/p_theme_save.php`: en √©dition (`id>0`), n‚Äô√©crit plus `flag_share_community`/`share_community_text_version` si l‚Äô√©diteur n‚Äôest pas l‚Äôauteur du contenu
    - `editor/t_theme_edit.php`: case ‚ÄúPartager ce contenu avec la communaut√© Cotton‚Äù affich√©e uniquement pour l‚Äôauteur
  - effet: une √©dition meta admin (ex: description) ne d√©r√©f√©rence plus une s√©rie Cotton/Communaut√© de la biblioth√®que
- [x] Z ‚Äî Biblioth√®que `A la une` / badge `En ce moment`: passage en fen√™tre stricte :
  - p√©rim√®tre: biblioth√®que uniquement (quiz + playlists)
  - r√®gle remplac√©e:
    - avant: fen√™tre glissante (d√©but accept√© jusqu‚Äô√† 90 jours dans le futur)
    - apr√®s: strictement ‚Äúen cours‚Äù (`today >= jour_associe_debut` et `today <= jour_associe_fin`)
  - impact:
    - tri prioritaire `A la une` bas√© uniquement sur les th√©matiques r√©ellement en cours
    - badge `En ce moment` affich√© uniquement pendant la p√©riode exacte
  - hors biblioth√®que: aucun changement
- [x] AA ‚Äî Quiz: champ `Commentaire` r√©int√©gr√© dans les formulaires d‚Äô√©dition/cr√©ation :
  - p√©rim√®tre:
    - cr√©ation/√©dition question sur s√©rie perso
    - cr√©ation de question de remplacement (lot temporaire, contexte session client)
    - modification de question (lot temporaire, contexte admin biblioth√®que)
  - UI:
    - ajout d‚Äôun champ `Commentaire` (`textarea`, max 1000) dans les formulaires concern√©s
    - pr√©remplissage du commentaire existant en √©dition
  - backend:
    - aucun changement de contrat n√©cessaire (payload `commentaire` d√©j√† valid√© et persist√©)
    - conservation des flux existants (remplacement client / √©dition admin)
- [x] AB ‚Äî Quiz formulaires: propositions regroup√©es + support en fin de formulaire :
  - p√©rim√®tre UI:
    - formulaires quiz biblioth√®que (`view`) : ajout / √©dition / remplacement
    - formulaires quiz s√©rie perso (`editor`)
  - ordonnancement harmonis√©:
    - `Question`, `Bonne r√©ponse`, `Commentaire`
    - bloc unique `Fausse proposition 1/2/3`
    - puis `Type support` + champs support en derni√®re section
  - harmonisation des labels:
    - suppression des libell√©s courts `Prop. 1/2/3` et des variantes `Proposition 1/2/3`
    - adoption uniforme `Fausse proposition 1/2/3`
  - coh√©rence UX:
    - suppression du champ `proposition_4` dans les formulaires s√©rie perso pour alignement √† 3 propositions
- [x] AC ‚Äî Quiz formulaires: ajustement visuel du champ `Commentaire` :
  - champ `commentaire` conserv√© facultatif
  - rendu monoligne dans les formulaires quiz cibl√©s (`input text`, sans impact backend)
  - ajout d‚Äôune mention d‚Äôaide homog√®ne sous le champ:
    - `√Ä l‚Äôattention du quiz master.`
  - style align√© avec les aides existantes (`small text-muted`)
- [x] AD ‚Äî Quiz formulaires: repositionnement du champ `Commentaire` :
  - coh√©rence d‚Äôordre appliqu√©e partout:
    - `Fausse proposition 1/2/3`
    - puis `Commentaire`
    - puis `Type support` + champs li√©s
  - aucun changement backend (champ facultatif inchang√©)
- [x] AE ‚Äî Quiz formulaires: retour √† la ligne apr√®s `Bonne r√©ponse` + retrait `mb-2` :
  - ajout d‚Äôun retour de ligne forc√© (`<div class="w-100"></div>`) apr√®s le champ `Bonne r√©ponse` dans les formulaires quiz cibl√©s
  - suppression de la marge basse `mb-2` sous le texte:
    - `Les fausses propositions sont essentielles pour la version num√©rique du quiz.`
  - backend inchang√©
- [x] AF ‚Äî Quiz formulaires: espacement au-dessus des boutons d‚Äôaction :
  - uniformisation des blocs de validation/ajout/enregistrement en `mt-4` (au lieu de `mt-2`/`mt-3`) sur les formulaires quiz cibl√©s
  - objectif: a√©ration coh√©rente avant les CTA de formulaire
  - backend inchang√©
- [x] V√©rifications techniques:
  - `php -l pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_lib.php` OK
  - `php -l pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_list.php` OK
  - `php -l pro/web/ec/ec.php` OK
  - `php -l pro/web/ec/modules/tunnel/start/ec_start_agenda_mode.php` OK
  - `php -l pro/web/ec/modules/tunnel/start/ec_start_sessions_view.php` OK
  - `php -l pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_view.php` OK (commentaire forms)
  - `php -l pro/web/ec/modules/jeux/bibliotheque/editor/t_theme_content.php` OK (commentaire forms)
  - `php -l pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_view.php` OK (ordre champs support/propositions)
  - `php -l pro/web/ec/modules/jeux/bibliotheque/editor/t_theme_content.php` OK (ordre champs support/propositions)
  - `php -l pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_view.php` OK (commentaire UI r√©duit + aide)
  - `php -l pro/web/ec/modules/jeux/bibliotheque/editor/t_theme_content.php` OK (commentaire UI r√©duit + aide)
  - `php -l pro/web/ec/modules/tunnel/start/ec_start_script.php` OK
- [ ] QA manuelle (√† ex√©cuter):
  - v√©rifier tag `En ce moment` uniquement sur items en p√©riode et non hors p√©riode
  - v√©rifier home INS CHR avec/sans sessions (`Mon agenda` visible)
  - v√©rifier masquage `Media Kit` sur 4 cas cibl√©s + non-r√©gression CHR
  - v√©rifier textes quiz sur pivot agenda mode en desktop/mobile
  - v√©rifier fiche session quiz: `T{id}` papier vs s√©ries classiques

## PATCH FILTER ‚Äî Biblioth√®que Quiz: qualit√© minimale des s√©ries (2026-02-27)
- [x] Objectif:
  - ajouter un filtre c√¥t√© biblioth√®que Quiz (`develop`) pour n‚Äôafficher que les s√©ries dont chaque question respecte:
    - au moins 3 propositions compl√®tes (r√©ponse + propositions),
    - r√©ponse correcte non vide.
- [x] Impl√©mentation centralis√©e:
  - `pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_lib.php`
    - ajout helper SQL `clib_quiz_lot_catalog_quality_filter_sql_get(...)`
    - application du filtre dans:
      - `clib_list_get(...)` (liste des s√©ries)
      - `clib_rubriques_filtered_get(...)` (rubriques visibles)
- [x] Scope:
  - Quiz biblioth√®que uniquement (`seo_slug_jeu === 'cotton-quiz'`)
  - aucun changement sur playlists Bingo/Blindtest
- [x] V√©rification technique:
  - `php -l pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_lib.php` OK
- [ ] QA manuelle:
  - s√©rie Quiz avec question <3 propositions compl√®tes => absente de la liste
  - rubrique ne contenant que des s√©ries non conformes => absente du dropdown Th√®mes
  - s√©ries conformes => inchang√©es

## PATCH UX ‚Äî Biblioth√®que view: bouton aper√ßu audio 10s avec √©tats visuels [2026-02-27]
- [x] Audit cibl√© impl√©mentation preview audio:
  - template + styles + JS dans `pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_view.php`
  - boutons identifi√©s:
    - `.js-clib-audio-preview` (fichiers audio)
    - `.js-clib-yt-audio-preview` (YouTube audio-only)
- [x] Patch minimal appliqu√©:
  - √©tats visuels du bouton `√âcouter 10s`:
    - `idle`: ic√¥ne play + libell√© `√âcouter 10s`
    - `loading`: spinner pendant chargement
    - `playing`: ic√¥ne stop + libell√© `Arr√™ter`
  - arr√™t manuel au clic en √©tat `playing`
  - retour automatique √† `idle`:
    - fin naturelle de l‚Äôextrait
    - timeout 10s
    - erreur de lecture/chargement
  - contrainte ‚Äúun seul aper√ßu actif √† la fois‚Äù:
    - lancement d‚Äôun nouvel aper√ßu => arr√™t propre du pr√©c√©dent (audio local ou YouTube)
  - stabilit√© visuelle:
    - largeur bouton stabilis√©e (`min-width`) + zone ic√¥ne fixe pour √©viter les sauts de layout
- [x] Scope technique:
  - `pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_view.php`
- [x] V√©rification technique:
  - `php -l pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_view.php` OK
- [ ] QA manuelle:
  - clic `√âcouter 10s` => `loading` puis `playing`
  - clic `Arr√™ter` => retour `idle` imm√©diat
  - fin 10s et erreurs => retour `idle`
  - lancement d‚Äôun 2e aper√ßu => arr√™t du 1er

## PATCH UI V1 ‚Äî Diff√©renciation Agenda vs Biblioth√®que (lecture temporelle) [2026-02-27]
- [x] Audit cibl√© de la vue agenda:
  - page principale: `pro/web/ec/modules/tunnel/start/ec_start_sessions_list.php`
  - composant carte: `pro/web/ec/modules/tunnel/start/ec_start_sessions_list_bloc.php`
  - constat: hi√©rarchie proche de la biblioth√®que (visuel dominant + lecture ‚Äúcatalogue‚Äù)
- [x] Patch UI minimal appliqu√© sur agenda uniquement:
  - regroupement visuel des sessions par date avec en-t√™te de section + compteur
  - hi√©rarchie carte renforc√©e sur `Quand`:
    - date + heure fusionn√©es sur une seule ligne (`DATE - HEURE`)
    - ligne temporelle en gras, non-wrap (mobile), accentuation couleur
  - visuel carte all√©g√© (hauteur image r√©duite) via scope CSS agenda
  - CTA secondaire carte renomm√© `G√©rer` + ic√¥ne de gestion (sliders)
  - suppression du sous-texte de page (it√©ration UX)
  - aucune modification des parcours m√©tier/navigation
- [x] Scope technique:
  - `pro/web/ec/modules/tunnel/start/ec_start_sessions_list.php`
  - `pro/web/ec/modules/tunnel/start/ec_start_sessions_list_bloc.php`
- [x] V√©rifications techniques:
  - `php -l pro/web/ec/modules/tunnel/start/ec_start_sessions_list.php` OK
  - `php -l pro/web/ec/modules/tunnel/start/ec_start_sessions_list_bloc.php` OK
- [ ] QA manuelle UX:
  - Biblioth√®que: rendu inchang√© (ou quasi inchang√©)
  - Agenda: lecture par date √©vidente au premier scroll
  - Desktop/mobile/tablette: pas de r√©gression responsive

## PATCH FIX ‚Äî Stepper `resume` masqu√© en biblioth√®que directe, conserv√© en agenda [2026-02-27]
- [x] Audit du point de d√©cision stepper:
  - affichage g√©r√© dans `pro/web/ec/modules/tunnel/start/ec_start_include_header.php` (`case 'start_step_4_resume'`)
  - stepper historiquement actif pour toute session non d√©mo (sans distinction de contexte)
- [x] R√©utilisation du signal de contexte existant (pas de nouvelle logique m√©tier):
  - `from=library` d√©j√† post√© depuis `start/game/setting` (flux biblioth√®que)
  - `tunnel=agenda` d√©j√† utilis√© pour distinguer la variante agenda via biblioth√®que
- [x] Patch minimal appliqu√©:
  - propagation du `tunnel=agenda` en hidden input dans `pro/web/ec/modules/tunnel/start/ec_start_step_2_setting.php`
  - redirection `session_setting` -> `resume` contextualis√©e dans `pro/web/ec/modules/tunnel/start/ec_start_script.php`:
    - biblioth√®que directe: `?from=library`
    - agenda via biblioth√®que: `?from=library&tunnel=agenda`
  - gating stepper sur `resume` dans `pro/web/ec/modules/tunnel/start/ec_start_include_header.php`:
    - stepper masqu√© si `from=library` sans `tunnel=agenda`
    - stepper conserv√© sinon
- [x] V√©rifications techniques:
  - `php -l pro/web/ec/modules/tunnel/start/ec_start_step_2_setting.php` OK
  - `php -l pro/web/ec/modules/tunnel/start/ec_start_script.php` OK
  - `php -l pro/web/ec/modules/tunnel/start/ec_start_include_header.php` OK
- [ ] QA manuelle parcours:
  - Biblioth√®que -> Programmer -> `start/game/resume/` => stepper masqu√©
  - Mon agenda -> tunnel normal -> `start/game/resume/` => stepper visible
  - autres usages `resume/` => inchang√©s

## PATCH FIX ‚Äî Home INS/CSO responsive avec sidebar visible [2026-02-25]
- [x] Correction cibl√©e du layout no-offer INS/CSO quand le menu gauche r√©duit la zone de contenu:
  - `pro/web/ec/modules/communication/home/ec_home_index.php`
  - `pro/web/ec/includes/css/ec_custom.css`
- [x] Gating strict du patch:
  - scope uniquement home no-offer INS/CSO (`offre_client_active_count==0` + pipeline `INS/CSO`)
  - aucune modification des autres profils/home
- [x] Marquage explicite des deux widgets du duo no-offer:
  - widget offre/commande: classe `home-nooffer-widget-offer`
  - widget biblioth√®que/d√©couverte: classe `home-nooffer-widget-library`
  - classes inject√©es via `ec_home_index.php` et propag√©es dans les widgets:
    - `pro/web/ec/modules/widget/ec_widget_ecommerce_abonnement.php`
    - `pro/web/ec/modules/widget/ec_widget_ecommerce_abonnement_cso.php`
    - `pro/web/ec/modules/widget/ec_widget_ecommerce_evenement.php`
    - `pro/web/ec/modules/widget/ec_widget_ecommerce_particulier.php`
    - `pro/web/ec/modules/widget/ec_widget_jeux_discover_library.php`
- [x] R√®gles responsive desktop `>=992px`:
  - ratio `2/3 - 1/3` appliqu√© sur le scope home no-offer INS/CSO m√™me sans classe body `sidebar-*` (corrige les √©crans desktop moyens)
  - renfort conserv√© quand sidebar visible (`sidebar-menu|sidebar-icons|sidebar-compact`)
  - `commande` forc√©e en `2/3`
  - `library` forc√©e en `1/3`
  - sur mobile: empilement inchang√©
- [x] Widget library (visuel):
  - banni√®re remplac√©e par `cotton-media-kit-portail.jpg`
  - mobile align√© au rendu desktop (visuel unique plein largeur, sans scroll horizontal)
- [ ] QA manuelle:
  - desktop + sidebar visible: 1 ligne `2/3 - 1/3`
  - desktop sans sidebar: comportement courant conserv√©
  - mobile: stack vertical

## PATCH ‚Äî Quiz papier quick: √©dition contr√¥l√©e des lots temporaires `T{id}` depuis la view biblioth√®que [2026-02-24]
- [x] Gating strict d‚Äô√©dition en view lot temporaire:
  - contexte requis: `context=session` + `nav_ctx=agenda` + `id_securite_session` valide
  - session requise: owner courant, quiz (`id_type_produit in (1,5)`), format papier (`flag_controle_numerique=0`)
  - session requise: pr√©sence d‚Äôau moins un token `T` dans `lot_ids` et appartenance du lot affich√© `T{id}` aux `lot_ids`
  - hors de ce contexte: view strictement read-only (pas d‚Äôaction de remplacement)
- [x] Action serveur d√©di√©e:
  - mode script: `content_library_temp_lot_question_replace`
  - options:
    - `replace_mode=pick` (autre question ‚Äúm√™mes crit√®res‚Äù)
    - `replace_mode=create` (cr√©ation puis remplacement imm√©diat)
  - validations:
    - droits session/tenant
    - lot temporaire dans la session
    - question source pr√©sente dans `questions_lots_temp.question_ids`
  - √©criture atomique:
    - lock + re-read `question_ids` (`FOR UPDATE`)
    - remplacement √† index exact (ordre conserv√©)
    - anti-doublon intra-lot
- [x] Option A ‚Äúm√™mes crit√®res‚Äù:
  - s√©lection d‚Äôune question alternative selon les m√™mes axes que la question source (dimensions picker V2: univers/rubrique/points/support/difficult√©/jour associ√©)
  - exclusions: question source + IDs d√©j√† dans le lot + `excluded_ids` globaux (quand contexte disponible via `qz_temp_ctx_init`)
  - fallback cibl√© s√©ries histoire auto:
    - si aucun r√©sultat strict et source avec `jour_associe`, √©largissement sur le crit√®re `jour_associe` uniquement (fen√™tre ¬±5 jours autour de la date session quand applicable)
    - exclusions intra-lot conserv√©es (source + questions d√©j√† pr√©sentes)
  - message explicite si aucune candidate
- [x] Option B ‚Äúcr√©er une nouvelle question‚Äù:
  - r√©utilisation des validations payload quiz existantes (`clib_theme_content_payload_validate`)
  - cr√©ation question avec `id_etat` source, et classification utilisateur via formulaire (`id_univers`, `id_rubrique`)
  - valeurs par d√©faut UI pour classification = question source
  - classification valid√©e serveur:
    - `id_univers` existe (`questions_univers`)
    - `id_rubrique` existe (`questions_rubriques`)
    - relation `rubrique.id_univers == id_univers` obligatoire
  - `id_points` / `difficulte` non repris depuis la source (valeurs standard pipeline quiz perso)
  - `date_fin_validite` hors scope (non g√©r√©e/reprise dans ce flux)
  - `jour_associe`:
    - si la source n‚Äôa pas de `jour_associe`: insertion avec `jour_associe=NULL` (input client ignor√©)
    - si la source a un `jour_associe`: valeur par d√©faut serveur = date du jeu (session), modifiable avec borne stricte serveur `[date_jeu-5j ; date_jeu+5j]`
  - assertion post-insert (univers/rubrique/jour_associe) avec purge de la question cr√©√©e en cas de mismatch
  - upload image support (type 1) g√©r√© aussi dans ce flux (m√™me endpoint image que l‚Äôajout question catalogue), rollback cr√©ation si upload invalide
- [x] UI view `T{id}`:
  - bouton de remplacement all√©g√© en ic√¥ne seule (`‚Üª`), visible seulement si gating valide
  - bouton positionn√© sur la m√™me ligne que la question, s√©par√© du texte (√©vite le passage du texte sous l‚Äôic√¥ne)
  - aper√ßu support int√©gr√© sur la m√™me ligne dans une colonne droite d√©di√©e (alignement vertical centr√©)
  - rendu question ‚Äús√©rie auto/temp‚Äù sur 2 lignes:
    - ligne meta: index + univers + rubrique + jour associ√© (si pr√©sent)
    - ligne titre: √©nonc√© question inchang√©
    - scope strict: uniquement view auto/temp (`T{id}`)
  - modale par question avec 2 actions:
    - `A) Remplacer par une nouvelle question existante (m√™mes crit√®res)` + CTA `Remplacer`
    - `B) Cr√©er une question de remplacement`:
      - formulaire masqu√© par d√©faut
      - CTA d‚Äôouverture `Ajouter une question`
      - CTA submit `Cr√©er et remplacer`
      - classification √©ditable dans le formulaire:
        - `Univers` en `<select>`
        - `Rubrique` en `<select>`
        - valeurs par d√©faut = univers/rubrique de la question source
        - changement univers => rechargement/filtrage des rubriques; reset rubrique si invalide (`Choisir...`)
      - `Jour associ√©` affich√© uniquement si la question source en poss√®de un ; pr√©fill date du jeu + min/max UI ¬±5 jours
      - mention d‚Äôaide affich√©e uniquement formulaire ouvert, en italique
      - pas de champ `Fausse proposition 4`
      - champs support conditionnels au `Type support`:
        - `Aucun`: aucun champ support affich√©
        - `Image`: upload image affich√©
        - `Audio`: champ URL YouTube Music affich√©
        - `Vid√©o`: champ URL YouTube + bornes d√©but/fin affich√©s
  - feedback post-action: bandeau `Question remplac√©e.`
- [x] Logs structur√©s:
  - `QUIZ_PAPER_TEMP_REPLACE_OK`
  - `QUIZ_PAPER_TEMP_REPLACE_ERR`
  - `QUIZ_PAPER_TEMP_REPLACE_PICK_EMPTY`
  - `QUIZ_PAPER_TEMP_REPLACE_CREATE_ERR`
  - `TEMP_LOT_REPLACE_CREATE_START`
  - `TEMP_LOT_REPLACE_CREATE_INSERT_OK`
  - `TEMP_LOT_REPLACE_CREATE_INSERT_ERR`
  - `TEMP_LOT_REPLACE_CREATE_DAY_OUT_OF_RANGE`
  - `TEMP_LOT_REPLACE_CREATE_ASSERT_MISMATCH`
  - `TEMP_LOT_REPLACE_WRITE_OK`
  - `TEMP_LOT_REPLACE_WRITE_ERR`

## PATCH ‚Äî View read-only lot temporaire `T{id}` [2026-02-23]
- [x] Ajout d‚Äôune route explicite de consultation lot temporaire:
  - `/extranet/games/library/temp/T{id}`
  - r√©√©criture vers `ec_bibliotheque_view.php` avec `token=T{id}`
- [x] View biblioth√®que compatible lots temporaires:
  - chargement `questions_lots_temp` (`id`, `nom`, `descriptif_court`, `question_ids`, `date_ajout`)
  - parsing JSON `question_ids` + chargement `questions` avec ordre `FIELD(id, ...)`
  - rendu read-only dans la m√™me UI que la view biblioth√®que existante (structure/classes/composants conserv√©s)
  - libell√©s adapt√©s (it√©ration UX):
    - titre simplifi√© `<nom s√©rie> (auto)` (ex: `Cette semaine dans l'histoire (auto)`)
    - sous-titre simplifi√© (sans pr√©fixe `S√©rie auto papier :`)
    - m√©ta simplifi√©es: `Niveau: Facile`, `Auteur: Cotton`, `Contenu: 6 questions`, `Dur√©e indicative: 5 min`
    - suppression des lignes `Date d'ajout` et `Mode: Lecture seule`
    - cas s√©rie histoire (`Cette semaine dans l'histoire`): ajout de `Date de r√©f√©rence: jj/mm/aaaa` (date session quiz si contexte agenda/session disponible)
  - visuel: fallback image par d√©faut appliqu√© aussi aux lots temporaires (m√™me convention que la cr√©ation de s√©rie perso)
  - suppression des actions d‚Äô√©dition/suppression/usage (lecture seule stricte)
- [x] Int√©gration depuis la view session:
  - `T{id}` devient cliquable vers la view d√©di√©e
  - compat parsing tokens `L/T` conserv√©e
  - fiche session agenda: suppression du badge `Auto`, suffixe `(auto)` ajout√© directement au nom de la s√©rie temporaire
- [x] Validation/s√©curit√©:
  - token normalis√© strictement (`^T\\d+$`) ou fallback `id` num√©rique
  - gestion UI coh√©rente ‚Äúintrouvable‚Äù si lot absent
  - restriction d‚Äôacc√®s en direct hors contexte session (admin only)
- [ ] TODO: √©dition / duplication d‚Äôun lot temporaire `T{id}` vers un lot catalogue `L{id}` (future)

## PATCH ‚Äî Quiz auto papier: lots temporaires `T,T,T,L` (V2 pickers) [2026-02-23]
- [x] G√©n√©ration auto papier quiz branch√©e uniquement en agenda quick:
  - conserve num√©rique inchang√© (`4xL`)
  - papier auto produit d√©sormais `lot_ids` au format `T{id},T{id},T{id},L{id}`
- [x] Ajout module V2 c√¥t√© quiz app:
  - pickers directs `questions.id` (history / arts / sciences)
  - anti-doublons inter-recettes via contexte partag√© `excluded_ids`
  - persistance `questions_lots_temp` (`nom`, `descriptif_court`, `question_ids`, `date_ajout`)
- [x] Idempotence session:
  - si `lot_ids` contient d√©j√† un token `T`, pas de r√©g√©n√©ration des temporaires
- [x] Validation format `lot_ids` renforc√©e:
  - regex stricte `^([LT]?\\d+)(,[LT]?\\d+)*$`
  - normalisation nombre nu => `L{id}`
- [x] UI Pro s√©curis√©e en pr√©sence de tokens `T` (parsing/affichage/suppression slot):
  - vue session quiz V2
  - bloc liste sessions
  - script suppression de slot
  - contexte biblioth√®que session quiz
- [x] Logs ajout√©s:
  - `QUIZ_PAPER_AUTO_TEMP_BUILD_START/OK/ERR`
  - `QUIZ_PAPER_AUTO_TEMP_PERSIST_OK/ERR`
  - `QUIZ_PAPER_AUTO_APPLY_OK/ERR`
- [ ] TODO: impl√©menter une purge de `questions_lots_temp` (TTL + strat√©gie de nettoyage)
- [ ] TODO: audit exhaustif des surfaces Pro affichant `lot_ids` pour UX d√©di√©e des tokens `T`

## PATCH FIX ‚Äî Home widgets (liens CTA + copy finale) [2026-02-23]
- [x] Correction scope home no-offer:
  - `pro/web/ec/modules/communication/home/ec_home_index.php`
  - closure `$render_offer_widget` mise √† jour pour capturer `$url_ecommerce`
- [x] URLs commande stabilis√©es (root-relative + suffixes conserv√©s):
  - `pro/web/ec/ec.php`
  - `/extranet/ecommerce/offers/abonnement/s1/1`
  - `/extranet/ecommerce/offers/evenement/s1/6`
  - `/extranet/ecommerce/offers/particulier/s1/1`
- [x] Widget CHR CSO commande:
  - `pro/web/ec/modules/widget/ec_widget_ecommerce_abonnement_cso.php`
  - CTA vers `/extranet/ecommerce/offers/abonnement/s1/1`
  - suppression mention `L'essai gratuit est r√©serv√© aux nouveaux clients.`
- [x] Widget d√©couverte (version finale):
  - `pro/web/ec/modules/widget/ec_widget_jeux_discover_library.php`
  - titre `Les jeux Cotton`
  - sous-titre `Parcours les catalogues Blind Test, Bingo Musical et Cotton Quiz.`
  - CTA fixe `D√©couvrir les jeux`
  - bullets texte final + alignement vertical centr√© texte/icone
  - icones sombres seulement pour typologie √©v√©nement (2/3)
  - carte cliquable globalement (`stretched-link`)
- [ ] QA manuelle:
  - v√©rifier les 4 widgets commande (abonnement, abonnement_cso, √©v√©nement, particulier) en home no-offer
  - v√©rifier les cibles CTA selon typologie
  - v√©rifier widget d√©couverte (styles + lien + mobile)

## PATCH UI ‚Äî Widgets home INS/CSO (discover + CSO offer refonte) [2026-02-23]
- [x] Ordonnancement home no-offer selon pipeline:
  - `INS` => widget d√©couverte en 1er, widget offre en 2e
  - `CSO` => widget offre en 1er, widget d√©couverte en 2e
  - impl√©mentation: `pro/web/ec/modules/communication/home/ec_home_index.php`
- [x] Widget d√©couverte des jeux refondu:
  - titres dynamiques:
    - `INS` => `D√âCOUVRE LES JEUX`
    - `CSO` => `RED√âCOUVRE LES JEUX`
  - CTA dynamiques:
    - `INS` => `D√©couvrir les jeux`
    - `CSO` => `Red√©couvrir les jeux`
  - header visuel en banni√®re 3 jeux (Blind Test / Bingo Musical / Cotton Quiz)
  - bullets valeur:
    - `Joue des d√©mos en 1 clic`
    - `Utilise tes contenus persos (playlists / s√©ries)`
    - `Programme tes sessions dans l'agenda`
  - pictos en cercle plein color√© selon typologie client (20/22/21)
  - impl√©mentation: `pro/web/ec/modules/widget/ec_widget_jeux_discover_library.php`
- [x] Widget CSO ‚ÄúChoisir une offre‚Äù refondu:
  - suppression pastille `Reprise d'abonnement`
  - nouveaux textes (titre, intro, 3 bullets)
  - CTA: `üöÄ Je choisis mon offre`
  - note conserv√©e: `L'essai gratuit est r√©serv√© aux nouveaux clients.`
  - impl√©mentation: `pro/web/ec/modules/widget/ec_widget_ecommerce_abonnement_cso.php`
- [ ] QA manuelle √† ex√©cuter:
  - INS (CHR / √©v√©nement / particulier): d√©couverte en 1er + couleur typo + CTA INS
  - CSO CHR: offre en 1er + d√©couverte en 2e (RED√âCOUVRE) + CTA CSO
  - responsive mobile: banni√®re d√©couverte lisible

## PATCH UX ‚Äî INS/CSO CHR widgets + offers labels [2026-02-23]
- [x] Audit INS/CSO r√©alis√© (source de v√©rit√© pipeline client):
  - valeur m√©tier lue via `client_pipeline_etat_get_nom($client_detail['id_pipeline_etat'])` dans `pro/web/ec/ec.php:60`
  - mapping DB dans `global/web/app/modules/entites/clients/app_clients_functions.php:676`:
    - SQL: `SELECT nom FROM referentiels_clients_pipeline_etats WHERE id = ...`
  - mapping inverse dans `global/web/app/modules/entites/clients/app_clients_functions.php:664`:
    - SQL: `SELECT id FROM referentiels_clients_pipeline_etats WHERE nom = ...`
- [x] Audit surfaces EC cibl√©es:
  - home widget no-offer CHR: `pro/web/ec/modules/communication/home/ec_home_index.php:20`
  - widget essai CHR existant: `pro/web/ec/modules/widget/ec_widget_ecommerce_abonnement.php:1`
  - offers ABN CTA: `global/web/app/modules/ecommerce/widget/app_ecommerce_bloc_offre_tarifaire_abn.php:207`
- [x] Patch home widget (UX only, tunnel Stripe inchang√©):
  - no-offer + segment CHR + pipeline `CSO` => widget r√©activation sans wording essai
  - impl√©mentation:
    - `pro/web/ec/modules/communication/home/ec_home_index.php`
    - `pro/web/ec/modules/widget/ec_widget_ecommerce_abonnement_cso.php` (nouveau)
- [x] Patch page offers (libell√©s CTA, CHR uniquement):
  - `INS` => bouton `Essayer gratuitement`
  - `CSO` => bouton `S'abonner` + note `L'essai gratuit est r√©serv√© aux nouveaux clients.`
  - non-CHR => libell√© inchang√©
  - impl√©mentation: `global/web/app/modules/ecommerce/widget/app_ecommerce_bloc_offre_tarifaire_abn.php`
- [ ] QA manuelle √† ex√©cuter:
  - CHR INS: home essai + offers `Essayer gratuitement`
  - CHR CSO: home r√©activation + offers sans essai
  - CHR actif: inchang√©
  - non-CHR: inchang√©

## Audit ‚Äî Paywall offre active (schedule vs start) [2026-02-20]
- [x] Audit r√©alis√© sans patch applicatif (documentation uniquement).
- [x] Garde-fou actuel localis√© c√¥t√© carte agenda (UI), pas au niveau source-of-truth backend:
  - `pro/web/ec/modules/tunnel/start/ec_start_sessions_list_bloc.php:291`
  - `pro/web/ec/modules/tunnel/start/ec_start_sessions_list_bloc.php:305`
  - `pro/web/ec/modules/tunnel/start/ec_start_sessions_list_bloc.php:536`
- [x] Flux PROGRAMMER cartographi√©:
  - Entr√©e onboarding selon offres actives (`id_etat=3`): `pro/web/ec/ec.php:63`, `pro/web/ec/ec.php:100`, `pro/web/ec/ec.php:119`
  - UI choix jeu -> POST `session_init`: `pro/web/ec/modules/tunnel/start/ec_start_step_1_game.php:52`
  - Handler create session: `pro/web/ec/modules/tunnel/start/ec_start_script.php:161`
  - Write session: `pro/web/ec/modules/tunnel/start/ec_start_script.php:258`
  - Lookup offre depuis `id_securite` sans filtre √©tat actif: `global/web/app/modules/ecommerce/app_ecommerce_functions.php:822`
- [x] Flux LANCER/JOUER cartographi√©:
  - Route play classique: `pro/web/.htaccess:200`
  - Handler play classique: `pro/web/ec/modules/tunnel/start/ec_start_sessions_play_classic.php:1`
  - G√©n√©ration liens launcher centralis√©e: `global/web/app/modules/jeux/sessions/app_sessions_functions.php:851`
  - Surface alternative (widget agenda) sans garde-fou UI √©quivalent: `pro/web/ec/modules/widget/ec_widget_client_lieu_sessions_agenda.php:100`
- [x] Candidats de d√©placement du garde-fou identifi√©s (sans impl√©mentation):
  - Enlever le blocage UI de programmation/lancement sur carte agenda (`sessions_list_bloc`).
  - Ajouter/centraliser le check offre active c√¥t√© backend de lancement (source-of-truth des routes launcher/play).
  - Ajouter message + CTA offres sur la carte session programm√©e quand lancement refus√© backend.

## PATCH ‚Äî Moved paywall to backend launch [2026-02-20]
- [x] Programmation ouverte sans offre active (garde-fou retir√© au moment ‚Äúprogrammer‚Äù):
  - `pro/web/ec/ec.php:98` (onboarding par d√©faut vers `choose/0`)
  - `pro/web/ec/modules/tunnel/start/ec_start_step_1_game.php:55` (transport `flag_session_demo`)
  - `pro/web/ec/modules/tunnel/start/ec_start_script.php:171` (session non-d√©mo autoris√©e via `flag_session_demo=0`)
- [x] Garde-fou d√©plac√© et centralis√© c√¥t√© backend lancement:
  - nouvelle fonction verdict: `global/web/app/modules/jeux/sessions/app_sessions_functions.php` (`app_session_launch_guard_get`)
  - blocage effectif sur route lancement: `pro/web/ec/modules/tunnel/start/ec_start_sessions_play_classic.php`
- [x] Uniformisation des surfaces UI vers le verdict backend:
  - funnel launcher via `/extranet/start/game/play/{id}` dans `app_session_get_link(..., 'launcher', ...)`
  - retrait du garde-fou local UI dans `pro/web/ec/modules/tunnel/start/ec_start_sessions_list_bloc.php`
- [x] Message refus lancement + CTA offres:
  - √©cran refus backend sur `start/game/play/{id}` avec CTA `Voir les offres`
- [x] Fix remaining entrypoints bloquant encore la programmation:
  - widget `Nouvelle session` (agenda vide / sans offre) ne pointe plus vers e-commerce, mais vers `choose/0`:
    - `pro/web/ec/modules/widget/ec_widget_jeux_sessions_cta.php`
  - route `start/game/offres` ne bloque plus quand 0 offre active, redirection vers `choose/0` (avec contexte conserv√©):
    - `pro/web/ec/modules/tunnel/start/ec_start_step_0_offres_client.php`
  - flux biblioth√®que non-demo: suppression du retour forc√© vers `/start/game/offres/`, envoi `session_init` avec `flag_session_demo=0` m√™me sans offre active:
    - `pro/web/ec/modules/jeux/bibliotheque/ec_bibliotheque_script.php`

## PATCH ‚Äî Home EC sans offre active (harmonisation widgets) [2026-02-20]
- [x] Affichage harmonis√© sur la home EC pour les clients sans offre active:
  - `pro/web/ec/modules/communication/home/ec_home_index.php`
  - ordre forc√©:
    - widget commande en position 1
    - widget `D√©couvre les jeux Cotton` en position 2
  - tous les autres widgets de home masqu√©s dans ce cas
- [x] Mapping widget commande sans d√©pendance au pipeline/usage (cas no-offer):
  - typologie `1/8` (+ d√©faut) -> `pro/web/ec/modules/widget/ec_widget_ecommerce_abonnement.php`
  - typologie `2/3` -> `pro/web/ec/modules/widget/ec_widget_ecommerce_evenement.php`
  - typologie `12` -> `pro/web/ec/modules/widget/ec_widget_ecommerce_particulier.php`
- [x] Bypass garde interne du widget abonnement pour clients sans offre active:
  - `pro/web/ec/modules/widget/ec_widget_ecommerce_abonnement.php`
  - suppression du blocage `id_pipeline_etat`/`id_solution_usage` quand `offre_client_active_count==0`
- [x] Nouveau widget biblioth√®que (contenu marketing enrichi + CTA):
  - `pro/web/ec/modules/widget/ec_widget_jeux_discover_library.php`
  - CTA vers `/extranet/games/library`

## PATCH ‚Äî Agenda quick mode + auto-th√©matique biblioth√®que [2026-02-22]
- [x] Entr√©e agenda rerout√©e avec pivot A/B apr√®s choix du jeu:
  - CTA `Ajouter` / `Nouvelle session` pointent vers `start/game/choose/*?from=agenda&mode=quick`
  - apr√®s `step_1_game` + `session_init` (jeu choisi), redirection vers `start/agenda/mode/{id_offre}` avec `id_securite_session` + `seo_slug_jeu`
  - compat conserv√©e sur `start/agenda/mode/{id_offre}` (fallback ‚ÄúChoisis d‚Äôabord un jeu‚Äù si contexte incomplet)
  - POST de s√©lection conserv√© via `start/agenda/mode/script`
- [x] Pivot UI Variante A (apr√®s step 1):
  - titre/sous-titre: `Nouvelle session` / `Comment veux-tu programmer tes prochaines sessions ?`
  - titre page dynamique selon jeu choisi:
    - `Nouvelle(s) session(s) de Blindtest`
    - `Nouvelle(s) session(s) de Bingo Musical`
    - `Nouvelle(s) session(s) de Cotton Quiz`
  - bloc `Programmation rapide` + image header locale `prog_rapide.jpg`
  - bloc `Choisir une th√©matique` + image header locale `prog_choisir_thematique.jpg`
  - textes blocs clarifi√©s:
    - `Programmation rapide : une ou plusieurs sessions`
    - `Choisir une th√©matique : une session √† la fois`
  - descriptions blocs adapt√©es au jeu:
    - Quiz: `s√©ries` / `tes s√©ries de quiz`
    - Bingo/Blindtest: `playlists` / `ta playlist`
  - CTA blocs color√©s selon jeu (`btn-color-blind-test|bingo-musical|cotton-quiz`)
  - CTA:
    - `Programmer par date(s)` -> `step_2_setting` quick (multi-dates)
    - `Choisir une th√©matique` -> biblioth√®que filtr√©e sur le jeu choisi
  - choix `Choisir une th√©matique` depuis la pivot:
    - ne transporte plus `id_securite_session` (pas de faux contexte session en biblioth√®que)
    - suppression de la session pr√©-initialis√©e si vide/incompl√®te (anti session fant√¥me)
- [x] Rep√®re de progression tunnel agenda (Option A):
  - composant compact non cliquable (`√âtape X/5 ‚Äî libell√©` + mini barre)
  - desktop inline √† gauche du titre, mobile au-dessus du titre
  - mapping appliqu√©:
    - `Jeu` (step 1) sur `start/game/choose` agenda quick
    - `Contenu` (step 2) sur pivot `start/agenda/mode` et biblioth√®que (`from=agenda&mode=library`)
    - `Param√®tres` (step 3) sur `start/game/setting` quick + biblioth√®que agenda (`from=library&tunnel=agenda`)
    - `R√©cap` (step 4) sur `start/game/resume`/`resume-batch`
    - `C‚Äôest pr√™t !` (step 5) sur `start/game/view`
  - couleur de barre bas√©e sur classes jeu existantes `bg-color-{seo_slug_jeu}` (pas de hardcode couleur)
  - contexte biblioth√®que agenda propag√©/persist√©:
    - pivot -> biblioth√®que: `from=agenda&mode=library`
    - URLs list/view conservent ce contexte
    - script biblioth√®que -> setting ajoute `tunnel=agenda` pour l‚Äô√©tape 3
- [x] Mode A ‚ÄúProgrammer par date(s)‚Äù:
  - context marker `from=agenda&mode=quick` sur `step_1_game` -> `session_init` -> `step_2_setting`
  - `step_2_setting` √©tendu en multi-dates (`session_dates[]`, `session_times[]`)
  - toggle de mode de planification: `Dates libres` / `R√©currence`
    - rendu en segmented control ‚Äúchips‚Äù (actif violet/texte blanc, inactif blanc/border violet/texte violet)
    - stockage du mode via hidden `schedule_mode` (pas de changement backend)
    - chips positionn√©s sous le label `Programmation`
  - bloc r√©currence: `weekly|biweekly|monthly`, r√®gle mensuelle (`nth_weekday` / `last_weekday`), `until_date`, horaires multiples
    - suppression du titre `Horaires`
    - label horaire final: `Heure(s) de session(s) (Appliqu√©e(s) √† toutes les dates.)`
    - bouton horaire simplifi√©: `+`
    - suppression de la microcopy `Chaque horaire ajoute une session √† chaque occurrence.`
    - titre horaire affich√© une seule fois (pas de duplication sur les nouvelles entr√©es)
    - ajout d‚Äôhoraire en incr√©ment automatique `+1h` (bas√© sur le dernier horaire de la liste)
    - bouton suppression des horaires centr√© verticalement sur sa ligne
    - uniformisation des tailles/hauteurs de champs (desktop/mobile)
  - bloc commun aper√ßu/confirmation:
    - compteur des occurrences (pluralisation corrig√©e)
    - mode `Dates libres`: preview masqu√©e (redondante)
    - mode `R√©currence`: suppression des occurrences au cas par cas maintenue dans la preview
    - limite douce 40 (warning + confirmation explicite)
  - header quick harmonis√©: `Param√®tres des sessions` (vs `Param√®tres de la session` hors quick)
  - suppression de ligne date/heure disponible avec garde-fou ‚Äúau moins une ligne‚Äù
  - bouton suppression ligne date/heure harmonis√© visuellement avec `+ Ajouter une date` et masqu√© quand une seule ligne reste
  - validation serveur renforc√©e:
    - au moins 1 date valide
    - tri chrono + d√©doublonnage date+heure
    - m√™mes longueurs `session_dates[]` / `session_times[]`
    - hard limit s√©curit√© `200`
    - fallback `Dates libres`: reprise serveur de `free_session_dates[]` / `free_session_times[]` si payload final absent
    - mode `R√©currence`: reconstruction serveur des occurrences √† partir de `recurrence_*` + `monthly_*` + `recurrence_times[]`
    - exclusions de preview appliqu√©es serveur (`excluded_occurrences`)
- [x] Cr√©ation batch N sessions:
  - nouveau `frm_mode=session_setting_multi` dans `ec_start_script.php`
  - cr√©ation 1 session/date + application settings + `session_theme`
  - r√©sum√© batch d√©di√© `start/game/resume-batch/{batch_token}`
- [x] Auto-th√©matique (source unique biblioth√®que):
  - r√©utilisation du ranking biblioth√®que (`clib_list_get(..., preset='themes')`)
  - r√©utilisation des stats popularit√© (`clib_popularity_stats_for_items_get`)
  - anti-r√©p√©tition 365j par jeu (quiz/bingo/blindtest), fallback `180 -> 30 -> 0`
  - anti-doublon intra-lot ‚Äúsi possible‚Äù
- [x] Logs structur√©s (info):
  - `AGENDA_QUICK_CREATE_BATCH`
  - `AGENDA_QUICK_THEME_PICK`
  - `AGENDA_QUICK_CREATE_DONE`
  - `AGENDA_QUICK_PREVIEW_BUILD`
  - `AGENDA_QUICK_OCCURRENCE_REMOVE`
  - `AGENDA_QUICK_SUBMIT`
- [x] ‚ÄúChanger la th√©matique‚Äù depuis agenda/fiche session:
  - CTA conserv√© uniquement sur la fiche d√©tail session (`start/game/view`)
  - redirection vers la liste biblioth√®que filtr√©e jeu + `id_securite_session` (pas de landing direct en fiche th√©matique)
  - bandeau jaune ‚ÄúModification de th√©matique‚Äù affich√© en biblioth√®que (liste + fiche)
  - application du th√®me sur session existante via `content_library_apply_session_theme` (sans duplication)
- [x] Quiz auto-th√©matique agenda quick:
  - tirage automatique de 4 s√©ries (m√™mes r√®gles de popularit√©/anti-r√©p√©tition)
  - payload multi-s√©ries appliqu√© via `session_theme` (CSV ids -> `lot_ids`)
- [x] Fiche d√©tail session Quiz V2:
  - CTA global ‚ÄúChanger la th√©matique‚Äù retir√© du header
  - affichage des s√©ries par d√©faut + actions par s√©rie (`Voir le d√©tail`, `Modifier cette s√©rie`)
  - responsive fiche session:
    - desktop: `Voir le d√©tail` inline √† c√¥t√© du titre de s√©rie
    - mobile: `Voir le d√©tail` sous le titre (dans le m√™me bloc)
  - r√©ordonnancement des s√©ries par drag-and-drop avec sauvegarde automatique imm√©diate
  - post-r√©ordonnancement: retour sur la fiche d√©tail (plus de redirection r√©sum√©)
  - suppression unitaire de s√©rie:
    - bouton `‚úï` affich√© seulement si >1 s√©rie
    - confirmation modale ‚ÄúEtes-vous s√ªr de vouloir supprimer cette s√©rie ?‚Äù
    - suppression de la derni√®re s√©rie => suppression de la session quiz
- [x] Fiche session agenda -> VIEW biblioth√®que (coh√©rence inter-jeux):
  - Quiz: liens `Voir le d√©tail` par s√©rie vers VIEW biblioth√®que contextualis√©e session
  - Bingo/Blindtest: lien `Voir le d√©tail` d√©plac√© √† gauche du bouton `Modifier la playlist`
  - Blindtest/Bingo: sous-titre et d√©tail playlist masqu√©s dans la fiche session (le d√©tail passe par la VIEW biblioth√®que)
- [x] VIEW biblioth√®que `context=session`:
  - bandeau dat√© contextuel par jeu (quiz/bingo/blindtest)
  - lien inline `Retour √† la session` ajout√© dans les bandeaux `context=session` (view + list), affich√© uniquement si session valide et appartenant au client courant
  - CTA principal remplac√© par `Retour √† la session`
  - CTA d√©mo masqu√©
  - lien `‚Üê Retour au catalogue` masqu√©
  - fallback mode normal si session invalide/non autoris√©e
  - wording apply session en fiche th√©matique:
    - CTA `Remplacer` (au lieu de `Appliquer √† cette session`)
    - texte d‚Äôaide: `Choisir cette playlist/s√©rie en remplacement dans ma session`
- [x] Harmonisation wording session/biblioth√®que:
  - fiche session: `Modifier la playlist` (Blindtest/Bingo) / `Modifier cette s√©rie` (Quiz)
  - bandeau biblioth√®que en mode modif session contextualis√©:
    - Quiz: `Choisis une autre s√©rie pour ton quiz`
    - Bingo: `Choisis une autre playlist pour ton bingo musical`
    - Blindtest: `Choisis une autre playlist pour ton blindtest`
- [x] Step choix jeu (start):
  - titre header: `Je programme mes sessions de jeu`
  - CTA cartes jeu: `Cr√©er mes jeux`
- [x] Fix contexte session biblioth√®que + Quiz slot-edit:
  - persistance du contexte session en biblioth√®que conditionn√©e par `nav_ctx=agenda` (plus d‚Äô√©tat collant implicite)
  - auto-purge s√©curit√©: `id_securite_session` sans `nav_ctx` => purge imm√©diate du contexte serveur
  - propagation de `id_securite_session` / `context` / `slot_index` / `nav_ctx` sur filtres, pagination, liens d√©tail et retours (uniquement en mode agenda)
  - purge forc√©e depuis menu `Les jeux` (`clear_session_ctx=1` + purge client storage best-effort)
  - menu actif contextualis√©: `nav_ctx=agenda` => `Mon agenda` actif; for√ßage explicite aussi en biblioth√®que `context=session` avec `id_securite_session`
  - bandeau `Contexte session actif` retir√© (liste/view biblioth√®que)
  - Quiz: modification de s√©rie par `slot_index` (remplacement du slot cibl√© uniquement, sans √©craser tout `lot_ids`)
  - Quiz: ajout suppression unitaire de s√©rie en fiche session (`‚úï`, suppression du slot)
  - restauration suppression session Quiz depuis fiche agenda (robustesse sur `phase_courante`)
  - correction pivot -> biblioth√®que (choix th√©matique) pour ne pas transporter `id_securite_session` et √©viter le faux mode ‚Äúchanger‚Äù
- [ ] QA manuelle √† finaliser:
  - 1 date quick => 1 session + th√®me auto + r√©sum√© batch (1 entr√©e)
  - N dates quick => N sessions, th√®mes attribu√©s, anti-doublon intra-lot
  - anti-r√©p√©tition 365j v√©rifi√© par jeu
  - fallback 180/30/0 v√©rifi√© en pool r√©duit
  - flux start standard et flux biblioth√®que existants non r√©gress√©s

## Content Library (clients)

### MVP checklist
- [x] D√©finir le p√©rim√®tre catalogue par jeu:
  - [x] Quiz -> s√©ries (`questions_lots`)
  - [x] Bingo/Blind -> playlists (`jeux_bingo_musical_playlists`)
- [x] Exposer les 3 vues m√©tier dans l‚ÄôUI:
  - [x] Cotton certifi√©es
  - [x] Communaut√©
  - [x] Mes th√©matiques
- [x] Impl√©menter les filtres:
  - [x] jeu
  - [x] rubrique
  - [x] type de contenu
  - [x] pagination
  - [x] rubriques contextualis√©es par s√©lection active (`jeu + onglet`)
  - [x] filtre rubrique en s√©lection directe (sans bouton de validation)
- [x] Fiche th√©matique:
  - [x] d√©tails √©ditoriaux
  - [x] image th√©matique (si pr√©sente dans uploads)
  - [x] auteur + √©tablissement auteur
  - [x] m√©tas d‚Äôusage visibles (nb d‚Äôutilisations / derni√®re utilisation)
  - [x] mode builder Quiz disponible aussi depuis la fiche (`Ajouter/Retirer` + `Continuer/Annuler`)
  - [x] d√©tail de contenu affich√© en page (questions Quiz / morceaux Bingo-Blind)
  - [x] aper√ßu multim√©dia l√©ger par type support (image miniature, audio extrait 10s, vid√©o extrait court)
  - [x] affichage usage align√© list: `Jou√©e x fois - derni√®re: ...` sous titre/sous-titre (retrait des lignes usage du bloc m√©ta)
  - [x] actions th√©matique (`Modifier les infos` / `Supprimer la playlist|s√©rie`) d√©plac√©es dans le bloc m√©ta, style align√© sur `Modifier le contenu`
  - [x] `Modifier le contenu` converti en bouton ic√¥ne + tooltip dynamique (`Modifier la playlist/s√©rie`), toggle ouverture/fermeture conserv√©
- [x] Action ‚ÄúProgrammer une session‚Äù depuis la fiche:
  - [x] `session_init` puis redirection vers `step_2_setting` avec transport `id_catalogue_produit` (`from=library`)
  - [x] apr√®s validation setting: auto-`session_theme` puis redirection vers r√©sum√©
  - [x] Quiz: confirmation puis mode builder sur la liste (session) pour s√©lectionner 1 √† 4 s√©ries, transport `quiz_lot_ids` jusqu‚Äôau `session_setting`
  - [x] Quiz: application multi-s√©ries via la logique existante du tunnel start (`lot_ids`)
- [x] Action ‚ÄúLancer une d√©mo‚Äù depuis la fiche:
  - [x] conservation du flux existant d√©mo: `session_init` puis `session_theme` (pas de `step_2_setting`)
  - [x] redirection vers r√©sum√© (CTA ‚ÄúOuvrir le jeu‚Äù)
- [x] Ajouter le point d‚Äôentr√©e UI:
  - [x] route `/extranet/games/library`
  - [x] menu lat√©ral EC ‚ÄúLes jeux‚Äù: clic parent => portail `/extranet/games/library` + sous-menu direct auto-ouvert en contexte biblioth√®que (`Blindtest` / `Bingo musical` / `Cotton Quiz`)
- [x] Action directe en liste:
  - [x] CTA principal unique par carte: `Voir le d√©tail`
  - [x] mode builder Quiz: action secondaire discr√®te `Ajouter au quiz` via ic√¥ne `+` (top-right), avec √©tat `‚úì` si d√©j√† ajout√©e
  - [x] lien de d√©tail conserv√© et contextualis√© (s√©rie/playlist), sans conflit de clic avec l‚Äôaction builder
  - [x] statut transitoire en bas de carte (`mine`) si non programmable: `S√©rie √† compl√©ter` / `S√©rie √† valider` / `Playlist √† valider`
  - [x] admin (`id_client=10`): statut temporaire `Non publi√©e` en bandeau jaune sur l‚Äôonglet `Communaut√©` quand `flag_share_community!=1`
  - [x] onglet `Communaut√©`: exclusion des contenus partag√©s par le client courant (ne pas voir ses propres contenus)
- [x] Enrichir la liste:
  - [x] affichage difficult√© (3 ic√¥nes + libell√©)
  - [x] m√©tas d‚Äôusage discr√®tes si `usage_count>0`
- [ ] Recherche texte (retir√©e par d√©cision UX sur cette it√©ration).
- [x] Recherche texte retir√©e de la list (UI supprim√©e, compat query `q` conserv√©e en silencieux).
- [ ] V√©rifier contr√¥les d‚Äôacc√®s (tenant + r√¥le contact) sur toutes les actions ci-dessus en QA manuelle.

### Tests manuels (MVP)
- [ ] Tenant isolation:
  - [ ] un client A ne voit pas ‚ÄúMes th√©matiques‚Äù du client B
  - [ ] les m√©tas d‚Äôusage n‚Äôagr√®gent pas cross-tenant
  - [ ] Parcours fiche -> programmer session:
  - [ ] arriv√©e sur `step_2_setting` (date + format)
  - [ ] s√©lection th√©matique conserv√©e jusqu‚Äôau r√©sum√©
  - [ ] `flag_configuration_complete=1` apr√®s validation
  - [ ] CTA `Ouvrir le jeu` fonctionnel depuis le r√©sum√©
  - [ ] Quiz: choix ‚Äúnon‚Äù √† l‚Äôajout -> 1 s√©rie -> setting -> r√©sum√©
  - [ ] Quiz: ajout de 3 s√©ries -> 4 s√©ries -> setting -> r√©sum√©
  - [ ] Quiz: tentative 5 s√©ries -> refus backend
  - [ ] Quiz: annuler le builder -> retour mode normal + s√©lection vid√©e
  - [ ] Quiz (fiche): mode builder actif visible, CTA `Ajouter au quiz` + √©tat `D√©j√† ajout√©e` (+ retrait), puis continuer vers setting/r√©sum√©
  - [ ] Quiz (liste builder): ic√¥ne `+` ajoute sans quitter la liste, √©tat `‚úì` visible, et ouverture du d√©tail toujours accessible
- [ ] Parcours fiche -> d√©tail contenu:
  - [ ] Quiz: affichage questions + support (type 1/2/3)
  - [ ] Bingo/Blind: affichage morceaux + support si URL disponible
  - [ ] audio: bouton `Extrait 10s` stop auto
  - [ ] vid√©o: mini player `Extrait 10s`
  - [ ] YouTube sans `start/t/end`: d√©marrage auto √† 30s
- [ ] Parcours fiche -> lancer d√©mo:
  - [ ] pas de passage par `step_2_setting` (comportement existant conserv√©)
  - [ ] session d√©mo cr√©√©e/dupliqu√©e en 2 joueurs quand attendu
  - [ ] arriv√©e directe au r√©sum√© avec CTA `Ouvrir le jeu` fonctionnel
- [ ] Contr√¥le r√¥les:
  - [ ] animateur (`id_client_contact_type=3`) respecte les restrictions existantes
- [ ] Non-r√©gression routing:
  - [ ] `/extranet/start/game/choose/*` (tunnel classique inchang√©)
  - [ ] `/extranet/start/game/choose/demo`
  - [ ] `/extranet/start/game/theme/*/{id_securite_session}`
  - [ ] `/extranet/start/script` (`session_init`, `session_theme`, `session_duplicate`)

## Biblioth√®que ‚Äî CRUD mine-only (create/edit)

### Impl√©mentation
- [x] Ajouter un adapter unifi√© metadata-only:
  - [x] `pro/web/ec/modules/jeux/bibliotheque/sources/quiz_series.php`
  - [x] `pro/web/ec/modules/jeux/bibliotheque/sources/playlists.php`
  - [x] API unifi√©e: `loadMeta/createMeta/updateMeta` (owner-check sur update)
- [x] Ajouter les √©crans d√©di√©s:
  - [x] `pro/web/ec/modules/jeux/bibliotheque/editor/t_theme_create.php`
  - [x] `pro/web/ec/modules/jeux/bibliotheque/editor/t_theme_edit.php`
  - [x] `pro/web/ec/modules/jeux/bibliotheque/editor/p_theme_save.php`
- [x] Brancher biblioth√®que sans toucher start:
  - [x] `Cr√©er` visible en onglet `mine` uniquement
  - [x] carte `+` en t√™te de grille `mine` (CTA principal cr√©ation)
  - [x] libell√© carte `+` contextualis√© jeu:
    - [x] Quiz: `Ajouter une s√©rie`
    - [x] Bingo/Blind: `Ajouter une playlist`
  - [x] ic√¥ne `+` color√©e avec la couleur du jeu actif
  - [x] formulaire create sans s√©lecteur de jeu quand `game` est pr√©filtr√© depuis la biblioth√®que
  - [x] `Modifier` visible sur la fiche uniquement si `id_client_auteur == $_SESSION['id_client']`
  - [x] save via `library/script` (`mode=content_library_theme_save`)
  - [x] option de partage communaut√© √©ditable en m√©ta (`t_theme_edit`) pour tous les contenus perso (Quiz/Bingo/Blind)
  - [x] retrait du mode d√©di√© `content_library_admin_quiz_share_toggle` (pilotage partage unifi√© via save m√©ta)
  - [x] suppression via `library/script` (`mode=content_library_theme_delete`) avec owner-check
  - [x] suppression visible uniquement depuis la fiche (retir√©e de l‚Äô√©cran edit)
  - [x] redirection vers la fiche avec `?saved=1`
  - [x] redirection suppression vers `mine` avec `?deleted=1`
  - [x] hardening anti-500:
    - [x] fallback local delete si `clib_theme_adapter_delete_meta()` indisponible
    - [x] fallback URL `mine` si helper lib indisponible
    - [x] try/catch delete sources (retour `false` au lieu de fatal SQL)

### Tests manuels (CRUD mine-only)
- [ ] Quiz:
  - [ ] cr√©er une s√©rie `mine` depuis la biblioth√®que (jeu=quiz)
  - [ ] v√©rifier apparition dans `Mes s√©ries`
  - [ ] modifier le titre depuis la fiche -> succ√®s + retour fiche
- [ ] Bingo/Blind:
  - [ ] cr√©er une playlist `mine` (jeu=bingo et jeu=blindtest)
  - [ ] v√©rifier apparition dans `Mes playlists`
  - [ ] modifier rubrique/description -> succ√®s + retour fiche
- [ ] Contr√¥les d‚Äôacc√®s:
  - [ ] bouton `Modifier` absent sur item non-mine
  - [ ] URL forc√©e d‚Äô√©dition d‚Äôun item non-mine -> refus backend
  - [ ] URL forc√©e de suppression d‚Äôun item non-mine -> refus backend
- [ ] UX cr√©ation:
  - [ ] depuis `Mes s√©ries` (quiz), carte `+` affiche `Ajouter une s√©rie` + ic√¥ne couleur Quiz
  - [ ] depuis `Mes playlists` (bingo/blind), carte `+` affiche `Ajouter une playlist` + ic√¥ne couleur jeu
  - [ ] create pr√©filtr√© jeu: pas de s√©lecteur jeu affich√©
- [ ] Garde-fou start:
  - [ ] `git diff --name-only` sans changement sous `/extranet/start/` / `ec_start_*`

## Biblioth√®que ‚Äî edit contenu (quiz series / playlists)

### Contrat add/remove/reorder (audit preuve file:line)
- [x] Quiz s√©ries (`questions_lots` -> `questions` + `questions_propositions`):
  - [x] cr√©ation/√©dition question + supports + propositions confirm√©e par:
    - [x] `pro/web/ec/modules/jeux/catalogue_series/catalogue_series_form_manager/ec_catalogue_series_form_manager_questions_create_or_update.php:77`
    - [x] `pro/web/ec/modules/jeux/catalogue_series/catalogue_series_form_manager/ec_catalogue_series_form_manager_questions_create_or_update.php:145`
    - [x] `pro/web/ec/modules/jeux/catalogue_series/catalogue_series_form_manager/ec_catalogue_series_form_manager_questions_create_or_update.php:172`
  - [x] chargement des questions + propositions confirm√© par:
    - [x] `pro/web/ec/modules/jeux/catalogue_series/catalogue_series_form_manager/ec_catalogue_series_form_manager_questions_get.php:406`
    - [x] `pro/web/ec/modules/jeux/catalogue_series/catalogue_series_form_manager/ec_catalogue_series_form_manager_questions_get.php:479`
- [x] Playlists (`jeux_bingo_musical_playlists` -> `jeux_bingo_musical_morceaux_to_playlists`):
  - [x] insertion avec `position` confirm√©e par:
    - [x] `pro/web/ec/modules/jeux/catalogue_playlists/ec_catalogue_playlist_import.php:199`
  - [x] consommation start via table de liaison confirm√©e par:
    - [x] `pro/web/ec/modules/tunnel/start/ec_start_script.php:629`
    - [x] `pro/web/ec/modules/tunnel/start/ec_start_script.php:638`

### Impl√©mentation (biblioth√®que only, mine-only)
- [x] Ajouter √©cran d√©di√© contenu:
  - [x] `pro/web/ec/modules/jeux/bibliotheque/editor/t_theme_content.php`
  - [x] UI minimale liste + add + remove + move + update item
- [x] Ajouter endpoint AJAX:
  - [x] `pro/web/ec/modules/jeux/bibliotheque/editor/p_theme_content_ajax.php`
  - [x] actions: `add`, `remove`, `move`, `update_item`
- [x] Ajouter adapters contenu:
  - [x] `pro/web/ec/modules/jeux/bibliotheque/sources/quiz_series_content.php`
  - [x] `pro/web/ec/modules/jeux/bibliotheque/sources/playlists_content.php`
  - [x] owner-check backend `id_client_auteur = $_SESSION['id_client']` avant write
  - [x] normalisation des positions apr√®s add/remove/move
  - [x] playlist mapping robuste sans d√©pendance `id` de la table de liaison (ops bas√©es sur `position`, comme dans start)
- [x] Brancher biblioth√®que:
  - [x] route editor `t_theme_content` dans `ec_bibliotheque_list.php`
  - [x] mode script `content_library_theme_content_ajax` dans `ec_bibliotheque_script.php`
  - [x] bouton fiche `Modifier contenu` visible uniquement pour `mine` dans `ec_bibliotheque_view.php`
  - [x] helpers adapter + URL dans `ec_bibliotheque_lib.php`
  - [x] hardening flux AJAX √©diteur contenu:
    - [x] submit JS avec headers `Accept: application/json` + `X-Requested-With`
    - [x] backend `content_ajax` avec sortie imm√©diate (`exit`) pour √©viter redirection parasite
    - [x] fallback non-AJAX: redirection vers `t_theme_content` (pas d‚Äôaffichage JSON brut)
  - [x] garde-fou r√©ponse add: refuser `success=true` si rechargement retourne `rows=[]`

### It√©ration playlist (alignement start/catalogue)
- [x] Ajouter playlist via URL playlist YouTube Music (et non ajout unitaire par morceau) pour Bingo/Blind:
  - [x] validation URL: `music.youtube.com/playlist?list=...`
  - [x] extraction `list` + import via API YouTube (playlistItems + videos)
  - [x] contrainte mini align√©e catalogue: minimum 40 morceaux
  - [x] import born√© √† 40 morceaux pour la playlist cible
- [x] Contraintes URL support:
  - [x] Quiz support type 2 (audio): URL YouTube Music titre requise (`music.youtube.com/watch?v=...`)
  - [x] Playlist Bingo/Blind (√©dition item): URL YouTube Music requise si renseign√©e
  - [x] liens YouTube classiques (`youtube.com`, `youtu.be`) refus√©s pour ces cas

### It√©ration playlist (mine-only) - workflow fiche 2026-02-16
- [x] R√©utiliser la logique d‚Äôimport playlist align√©e start/catalogue (sans modifier start):
  - [x] ajout via URL playlist YouTube Music uniquement (`/playlist?list=...`)
  - [x] minimum 40 / import max 40
  - [x] signaux ‚Äútitres douteux‚Äù repris du flux analyse/import catalogue (levenshtein artiste/cha√Æne, termes suspects, patterns)
- [x] Changer le post-import biblioth√®que:
  - [x] redirection vers la fiche en mode visu (`?imported=1`) et non vers l‚Äô√©diteur contenu
  - [x] stockage flash import (`imported_count`, `doubtful_count`, `doubtful_rows`)
  - [x] affichage fiche: mise en avant inline des lignes douteuses/non fonctionnelles (pas de bloc s√©par√©)
- [x] UX fiche playlist (vide + remplie):
  - [x] formulaire lien YT Music disponible en mode visu
  - [x] fiche remplie: bloc import supprim√©
  - [x] fiche vide: bloc import visible
  - [x] fiche vide: pas de titre section contenu ni placeholder vide
  - [x] fiche vide: pas de CTA `Cr√©er mon jeu` / `D√©mo`
  - [x] bouton import renomm√© `Importer`
  - [x] actions owner `Modifier/Supprimer` remplac√©es par ic√¥nes pr√®s du titre
  - [x] √©dition unitaire: ic√¥ne ligne + bouton `Valider`, formulaire sur ligne d√©di√©e avant aper√ßu
  - [x] surbrillance coh√©rente: message d‚Äôalerte + lignes concern√©es
- [x] Validation obligatoire playlists perso (legacy valid√© par d√©faut):
  - [x] migration sch√©ma `jeux_bingo_musical_playlists`:
    - [x] `flag_validated TINYINT(1) NOT NULL DEFAULT 1`
    - [x] `validated_at DATETIME NULL`
    - [x] `flag_rights_waiver_accepted TINYINT(1) NOT NULL DEFAULT 0`
    - [x] `rights_waiver_accepted_at DATETIME NULL`
    - [x] `rights_waiver_text_version VARCHAR(16) NULL`
  - [x] legacy safe:
    - [x] playlists existantes consid√©r√©es valid√©es par d√©faut
  - [x] cr√©ation playlist `mine`:
    - [x] for√ßage `flag_validated=0`
    - [x] init `validated_at/rights_waiver_*` √† `NULL/0`
    - [x] pas de reset de ces champs sur update m√©tadonn√©es
  - [x] fiche `p=view` transitoire (`mine` + `flag_validated=0`):
    - [x] masquage CTA d‚Äôusage (`Cr√©er mon jeu` / `D√©mo`)
    - [x] affichage bloc en bas ‚ÄúValidation requise‚Äù
    - [x] checkbox waiver (texte juridique) + pr√©nom auteur obligatoires
    - [x] bouton ‚ÄúValider la playlist‚Äù d√©sactiv√© si `suspect_count>0` ou pr√©nom vide ou checkbox non coch√©e
  - [x] backend validation:
    - [x] nouveau mode `content_library_playlist_validate`
    - [x] v√©rification owner-only (`id_client_auteur == $_SESSION['id_client']`)
    - [x] recalcul serveur suspects via source playlists (pas de confiance client)
    - [x] refus si suspects restants / pr√©nom vide / waiver d√©coch√© / contenu < 40
    - [x] write `flag_validated=1` + `validated_at` + `nom_auteur` + waiver flags/dates/version
    - [x] redirect succ√®s `?validated=1`, erreurs via `?error=...`
  - [x] garde-fou backend usage:
    - [x] `content_library_program` et `content_library_demo` refus√©s si playlist `mine` non valid√©e (URL forc√©e incluse)
  - [x] ajustements post-impl√©mentation:
    - [x] pas de revalidation demand√©e apr√®s edits b√©nins: si des suspects r√©apparaissent, usage bloqu√© mais `flag_validated` conserv√©
    - [x] correction marquage suspects: corriger une ligne ne retire plus les autres suspects
    - [x] clic `Valider` sur une ligne suspecte sans modification: ligne consid√©r√©e manuellement ‚Äúok‚Äù (retrait du suspect cibl√©)
    - [x] bloc validation cach√© tant qu‚Äôaucun lien playlist n‚Äôa √©t√© soumis (fiche vide)
    - [x] tooltip explicatif sur bouton validation disabled (raisons dynamiques)
    - [x] champ validation align√© DB existante: `nom_auteur` (suppression usage `author_first_name`)
- [x] Cr√©er playlist (editor=t_theme_create):
  - [x] suppression du champ `Jeu`
  - [x] s√©lecteur difficult√© d√©plac√© en bas
  - [x] import en mode remplacement du contenu existant (`replace_existing=1`)
- [x] Modifier playlist (editor=t_theme_edit):
  - [x] suppression du champ `Jeu`
  - [x] s√©lecteur difficult√© ajout√©
  - [x] persistance difficult√© en update playlist
- [x] Compteurs d‚Äôusage:
  - [x] exclusion des sessions d√©mo (`flag_session_demo=0`) pour `usage_count` / `last_used_at`
- [x] UX liste biblioth√®que (filtres):
  - [x] onglets `Cotton/Communaut√©/Mes` en style soft-tabs avec soulignement accentu√© couleur du jeu
  - [x] retrait du select `Rubrique`
  - [x] ajout chips `Rubrique` cliquables (incluant `Toutes les rubriques`) avec filtre 1 clic
  - [x] chips positionn√©s au-dessus de la ligne de r√©sultats
  - [x] chips actifs Bingo/Blindtest: texte couleur fond de page
  - [x] ligne de r√©sultats color√©e avec la couleur du jeu s√©lectionn√©
  - [x] chips all√©g√©s visuellement (outline discret, densit√© r√©duite, actif plus doux)
  - [x] onglet `Communaut√©`: filtre `A la une` ajout√© (√† gauche de `Nouveaut√©s`) et d√©fini par d√©faut
  - [x] `A la une` communaut√© = top 12 popularit√©
  - [x] onglet `Perso`: suppression du filtre `Nouveaut√©s`, conservation du filtre `Th√®mes` uniquement (par d√©faut: toutes)
  - [x] tri des contenus `Perso`: plus r√©cent -> plus ancien
  - [x] chip `Toutes les s√©ries/playlists` s√©par√© du dropdown `Th√®mes`:
    - [x] `Cotton` / `Communaut√©`: chip plac√© √† droite de `Th√®mes`
    - [x] `Perso`: chip plac√© √† gauche de `Th√®mes` et actif par d√©faut
  - [x] layout cartes liste:
    - [x] titre page: `Catalogue des playlists/s√©ries du <jeu>`
    - [x] sous-titre `Parcours le catalogue...` supprim√©
    - [x] densit√© cartes: 4 colonnes max sur √©cran large
    - [x] bandeau bas l√©ger avec bouton unique `Voir le d√©tail`
    - [x] liens prog/d√©mo retir√©s de la carte liste
    - [x] bouton `Voir le d√©tail`: style des blocs choix jeu (portail biblioth√®que) + fl√®che √† droite
- [x] UX Biblioth√®que list/view (2026-02-18):
  - [x] `/extranet/games/library` devient un portail ‚ÄúLes jeux‚Äù (hub) avec 3 blocs de s√©lection (quiz/bingo/blindtest), r√©utilisant le pattern visuel de `start > step_1_game`
  - [x] list filtr√©e activ√©e via `?game=quiz|bingo|blindtest` (compat conserv√©e avec `seo_slug_jeu`)
  - [x] suppression des 3 blocs de jeu en haut de la list (page all√©g√©e)
  - [x] titre list simplifi√© au nom du jeu (`Blindtest` / `Bingo Musical` / `Cotton Quiz`) + sous-titre dynamique playlists/s√©ries selon jeu
  - [x] menu lat√©ral EC renomm√©: `Bibliotheque` -> `Les jeux` (lien inchang√© `/extranet/games/library`)
  - [x] POC UX list (game s√©lectionn√© uniquement):
    - [x] segmented `source` en soft-tabs √† libell√©s contextuels:
      - [x] Quiz: `S√©ries Cotton` / `S√©ries de la communaut√©` / `Mes s√©ries`
      - [x] Bingo/Blind: `Playlists Cotton` / `Playlists de la communaut√©` / `Mes playlists`
      - [x] style renforc√©: uppercase + taille augment√©e + contraste actif sur couleur du jeu
    - [x] suppression de la barre recherche/tri (UI retir√©e; params legacy compatibles si pr√©sents en URL)
    - [x] filtres actifs list: `A la une` / `Nouveaut√©s` / `Th√®mes` (suppression `Populaires` et chip `Toutes`)
    - [x] `Th√®mes` ouvre un dropdown rubriques (p√©rim√®tre actif `jeu + type`) avec entr√©e reset contextualis√©e:
      - [x] Quiz: `Toutes les s√©ries`
      - [x] Bingo/Blind: `Toutes les playlists`
    - [x] suppression compl√®te de l‚Äôancienne rang√©e de chips rubriques
    - [x] wiring URL list align√© MVP: `type`, `preset`, `id_rubrique`, `page` (+ compat silencieuse `q/sort/perso_state/source`)
    - [x] non-cumul des filtres: un seul actif √† la fois (`A la une` ou `Nouveaut√©s` ou `Th√®mes`)
    - [x] reset `Toutes les s√©ries/playlists` en mode `Th√®mes` (plus de retour implicite vers `A la une`)
    - [x] √©tat par d√©faut: `A la une`
    - [x] d√©faut au switch de source:
      - [x] `Cotton` => `A la une`
      - [x] `Communaut√©` / `Perso` => `Nouveaut√©s`
      - [x] reset rubrique au switch (`id_rubrique=0`)
    - [x] visibilit√© presets:
      - [x] `A la une` affich√© uniquement sur l‚Äôonglet `Cotton`
      - [x] `Nouveaut√©s` affich√© sur `Cotton`, `Communaut√©` et `Perso`
      - [x] `Communaut√©` / `Perso`: `Nouveaut√©s` + `Th√®mes`
    - [x] limites de s√©lection:
      - [x] `A la une`: 12 entr√©es max
      - [x] `Nouveaut√©s`: 12 entr√©es max
    - [x] `A la une` (`Cotton`): compl√©tion si `<12` avec les th√©matiques les plus populaires du catalogue
    - [x] `Th√®mes`: tri par popularit√© d√©croissante (puis derni√®re utilisation, puis id)
    - [x] √©tats vides avec CTA contextualis√©s (Cotton / Communaut√© / Perso)
    - [x] preset `now` branch√© sur logique existante tunnel start/catalogue:
      - [x] Quiz: r√®gle ‚Äú√† la une‚Äù (`flag_une` + `jour_associe_*` vides, scope Cotton)
      - [x] Bingo/Blind: fen√™tre date `jour_associe_*` (scope Cotton)
    - [x] preset `new` align√© sur le comportement existant ‚Äúr√©cents‚Äù (tri descendant)
      - [x] r√®gle exacte biblioth√®que: aucun seuil de date, pas de filtre additionnel; tri `ORDER BY id DESC` sur table catalogue (`questions_lots` / `jeux_bingo_musical_playlists`)
      - [x] r√®gle exacte tunnel start `step_3_theme`: aucun seuil de date, pas de filtre additionnel (hors statut publi√©); tri `ORDER BY id DESC` via `ec_catalogue_series_list.php` / `ec_catalogue_playlists_list.php`
      - [x] champs impliqu√©s ‚ÄúNouveaut√©s‚Äù: `id` (tri) + statut publication (`id_etat=2` pour Quiz, `online=1` pour playlists)
  - [x] Popularit√© hors d√©mo (12 mois) par th√©matique:
    - [x] table d‚Äôagr√©gats d√©di√©e `reporting_games_content_popularity_365d` (cl√© logique `game + content_type + id_catalogue_produit`)
    - [x] m√©triques stock√©es: `uses_365d_nondemo`, `last_used_at_nondemo`, `is_top_10pct_365d`, `computed_at`
    - [x] filtre temporel glissant: `date >= NOW() - INTERVAL 365 DAY`
    - [x] filtre hors d√©mo: `flag_session_demo=0` + `flag_configuration_complete=1`
    - [x] cas Quiz multi-s√©ries: incr√©ment par lot via parsing `lot_ids` (tokens `L<id>`) + prise en compte `id_produit`
    - [x] UI list: badge `Populaire` (Top 10%) + tooltip ‚ÄúTop playlist/s√©rie ¬∑ X utilisations depuis 1 an‚Äù
    - [x] style badge `Populaire`: fond `#582AFF`, texte blanc, ic√¥ne √©toile
    - [x] UI view: ligne `Popularit√©` affich√©e uniquement pour Top 10% avec message √©ditorial (`Cette playlist/s√©rie fait partie des 10% les plus utilis√©es !`)
    - [x] suppression du script rebuild CLI obsol√®te (rebuild assur√© par le cron reporting)
    - [x] recalcul p√©riodique branch√© dans le cron quotidien BO WWW: `www/web/bo/cron_routine_bdd_maj.php` (sans d√©pendance runtime au module `pro`)
  - [x] liste `mine` Bingo/Blind non valid√©e: remplacement CTA `Cr√©er mon jeu` + `D√©mo` par bouton unique `√Ä valider` vers `p=view`
  - [x] conservation contexte navigation list->view->list (`type`, `preset`, `id_rubrique`, `page`, `builder` + compat params legacy)
  - [x] fiche playlist: bouton/ic√¥ne `Modifier` rendus plus discrets (style ghost/outline fin)
  - [x] √©dition unitaire morceau: labels visibles `Artiste`, `Titre`, `Lien YouTube`
  - [x] aper√ßu playlist Bingo/Blind compact: action `‚ñ∂ √âcouter 10s` sans libell√© `Support` ni lien YouTube en visu
  - [x] contraste ajust√©: chips rubriques (list) + actions/ic√¥nes outline (view)
  - [x] view: √©dition m√©tas cal√©e visuellement sur le bouton `D√©mo` (ic√¥ne seule)
  - [x] view: √©dition ligne cal√©e sur le style lien d√©tail (`Modifier` + ic√¥ne) et plac√©e √† c√¥t√© du titre
  - [x] liens retour (`Retour au catalogue/fiche`) : hover/focus en blanc pour √©viter la disparition sur fond body
  - [x] ligne de contexte blanc entre supra-filtres et chips, avec message contextualis√© `Cotton/Communaut√©/Perso`
  - [x] suppression de la carte vide redondante ‚ÄúTu n‚Äôas pas encore de contenus perso‚Äù
  - [x] message vide builder quiz (mine): `Aucune s√©rie perso disponible...`
  - [x] mode builder Quiz (liste + fiche):
    - [x] s√©lection affich√©e ligne par ligne avec fond l√©ger couleur jeu
    - [x] r√©ordonnancement drag-and-drop + persistance ordre via `ordered_ids`
    - [x] action `Retirer` par ligne
    - [x] exclusion des s√©ries non valid√©es + masquage cr√©ation nouvelle s√©rie en mode builder
  - [x] microcopy/titres builder harmonis√©s (`Compose ton quiz (X / 4 s√©ries max.)` + sous-titre explicite 1..4 + cas `4/4` = `Ta s√©lection est compl√®te.` + CTA principal `Valider`)
  - [x] mode builder liste: quand la s√©lection est pleine (`4 / 4`), ic√¥ne `+` d√©sactiv√©e avec tooltip `Limite atteinte`
  - [x] view (hors builder): encart d‚Äôusage unique en haut de fiche (`Utiliser cette playlist/s√©rie`) avec 2 CTA unifi√©s:
    - [x] primaire dynamique `Cr√©er un <jeu>` (Cotton Quiz / Bingo musical / Blindtest)
    - [x] secondaire `Lancer une d√©mo`
    - [x] aide contextuelle: `Cr√©e une session pour jouer, ou lance une d√©mo pour tester rapidement.`
    - [x] placement: apr√®s header + m√©tas, avant le d√©tail du contenu
  - [x] ajustement UX view (rollback): CTA r√©int√©gr√©s inline dans l‚ÄôUI (sans section d√©di√©e ni titre), avec phrase d‚Äôaide conserv√©e
  - [x] quiz view: CTA renomm√© `Utiliser cette s√©rie`, sans modale, redirection directe vers la liste avec builder visible et s√©rie ajout√©e (persist√©e via session builder)
  - [x] view contenu: bouton d‚Äôaper√ßu audio compact et inline (m√™me ligne que la question/le morceau)
  - [x] view contenu: suppression de l‚Äôaffichage texte `Support : Audio/Vid√©o/Image`
  - [x] view contenu: alternance visuelle une ligne sur deux (fond gris l√©ger) pour distinguer les index
  - [x] fiche mine (playlist/s√©rie): √©dition du contenu via toggle global unique (ic√¥ne roue crant√©e pr√®s du titre), suppression des liens unitaires `Modifier` en visu
  - [x] mode √©dition contenu: fond warning l√©ger + s√©paration visuelle renforc√©e des items + aper√ßu support au-dessus des champs
  - [x] playlist view: compteur nombre de morceaux affich√© √† c√¥t√© de `Contenu de la playlist`
  - [x] quiz view: si `0` question, masquer `Contenu de la s√©rie 0/6` + `Aucune question disponible`; si `>=1`, placer bloc ajout au-dessus du contenu
  - [x] suppression des bandeaux info post-save (`Th√©matique mise √† jour`, `S√©rie en cours de cr√©ation...`) pour tous les jeux
  - [x] bloc validation (owner non valid√©):
    - [x] positionn√© entre m√©tas et contenu avec fond warning l√©ger
    - [x] texte titre harmonis√© (`Ta playlist/s√©rie est compl√®te...`)
    - [x] champ pr√©nom pr√©rempli depuis l‚Äôutilisateur actif (modifiable)
    - [x] ordre cases invers√©: partage communaut√© (optionnel, coch√© par d√©faut) puis consentement (obligatoire)
    - [x] consentement long inline sans info-bulle
    - [x] si playlist avec suspects: bloc validation masqu√©, message d√©di√© affich√© √† la place, √©dition auto-ouverte sur lignes suspectes
    - [x] flag `flag_share_community` persist√© √† la validation (quiz + playlists), avec `share_community_set_at`/`share_community_text_version` si colonnes disponibles
    - [x] flag partage fig√© apr√®s validation (les actions d‚Äô√©dition ne permettent pas sa modification)
  - [x] Publication communaut√© auto + sync transparent (√©tape 2):
    - [x] table `community_items` ajout√©e (index de publication communaut√©)
    - [x] publication initiale auto √† la validation owner si `flag_share_community=1` (cr√©ation item `published`)
    - [x] synchronisation auto sur mutation owner (m√©tas + contenu) en update in-place (sans rotation/versioning/clone source)
    - [x] suppression owner: bascule de l‚Äôitem communaut√© en `hidden`
    - [x] items `community` list√©s uniquement si:
      - [x] `flag_share_community=1`
      - [x] contenu valid√©
      - [x] item `community_items` `published` existant
    - [x] UI cards/view communaut√©: renderer inchang√© (aucune information technique de snapshot affich√©e)
    - [x] sessions: `championnats_sessions.community_item_id` aliment√© lors du lancement biblioth√®que en contexte `type=community`
  - [x] Legacy communaut√© (√©tape 3):
    - [x] identification origine legacy:
      - [x] `COTTON_AUTHOR_ID` via helper/config (fallback legacy `id_client_auteur=0`)
      - [x] r√®gle quiz listable actuelle: `id_etat=2` (c‚Äôest le statut qui ‚Äúmasque/affiche‚Äù)
      - [x] r√®gle playlists listables actuelle: `online=1`
    - [x] script idempotent ajout√©: `pro/web/ec/modules/jeux/bibliotheque/scripts/rebuild_community_items_legacy.php`
      - [x] alimentation/UPSERT `community_items` en `published` pour les contenus listables legacy
      - [x] sync des flags source legacy (`flag_share_community=1`) pour les contenus perso d√©j√† publi√©s en communaut√©
      - [x] origin:
        - [x] `cotton` si `id_client_auteur == COTTON_AUTHOR_ID`
        - [x] `legacy_community` sinon
      - [x] unique logique appliqu√©e sur `(game, content_type, source_type, source_id, status)` + gestion anti-doublon
      - [x] script SQL importable ajout√©: `pro/web/ec/modules/jeux/bibliotheque/scripts/rebuild_community_items_legacy.sql` (usage phpMyAdmin)
      - [x] r√®gle Cotton legacy verrouill√©e pour op√©ration DB: `id_client_auteur = 0` (ID `10` en communaut√© legacy)
    - [x] listing `Cotton/Communaut√©` branch√© sur `community_items` `published` (et non plus uniquement sur `id_client_auteur`)
      - [x] onglet `Cotton` => `origin='cotton'`
      - [x] onglet `Communaut√©` => `origin IN ('legacy_community','shared_from_personal')`
      - [x] hydratation cards/view inchang√©e depuis les tables source (pas de rendu technique expos√©)
      - [x] fallback automatique vers la logique legacy si `community_items` n‚Äôest pas encore peupl√© pour le contexte courant (√©vite les listes vides)
- [x] Import playlists robuste:
  - [x] exigence stricte de 40 insertions (pas de succ√®s partiel)
  - [x] rollback batch si insertions < 40
  - [x] messages d‚Äôerreur d√©taill√©s remont√©s en AJAX (au lieu de `Action impossible`)
  - [x] URLs morceau normalis√©es au format `https://youtu.be/<id>` (alignement start/import)
- [x] √âdition unitaire depuis la fiche:
  - [x] formulaire par ligne ferm√© par d√©faut (`details`)
  - [x] mapping ligne corrig√© avec `map_id` (plus d‚Äôerreur ‚ÄúLigne introuvable‚Ä¶‚Äù)
  - [x] modification in-place du morceau cibl√© (pas de cr√©ation de ligne suppl√©mentaire)
  - [x] retrait du marquage `douteux` apr√®s correction d‚Äôune ligne

### Tests manuels (edit contenu)
- [ ] Quiz (s√©rie mine):
  - [ ] cr√©ation s√©rie mine: arriv√©e fiche en mode interm√©diaire `0/6`
  - [ ] bandeau interm√©diaire visible: `S√©rie en cours de cr√©ation ‚Äî X/6 questions`
  - [ ] bloc `Ajouter une question` visible tant que `countQuestions < 6`
  - [ ] ajouter 2 questions
  - [ ] modifier texte/support d‚Äôune question
  - [ ] modifier une question via bouton `Modifier` (formulaire repliable) + `update_item` AJAX
  - [ ] aucun tag `Valide/Invalide` affich√© en fiche
  - [ ] list `mine` Quiz: bouton unique `√Ä compl√©ter` tant que `<6` (pas de `Cr√©er mon jeu` / `D√©mo`)
  - [ ] `Cr√©er mon jeu` / `D√©mo` masqu√©s tant que `countQuestions < 6` en fiche
  - [ ] √† `6/6`: bloc ajout masqu√© + bloc `Validation requise` affich√©
  - [ ] √† `6/6` non valid√©e: list `mine` affiche `√Ä valider`, pas de `Cr√©er mon jeu`/`D√©mo`
  - [ ] validation officielle quiz (pr√©nom + waiver) => `Cr√©er mon jeu`/`D√©mo` visibles
  - [ ] si retour `<6` (suppression), validation quiz r√©initialis√©e
  - [ ] r√©ordonner monter/descendre
  - [ ] retirer 1 question
  - [ ] rechargement fiche biblioth√®que: contenu conforme
  - [ ] fiche Quiz owner: CTA haut `Modifier` + `Supprimer` (style playlist)
- [ ] Playlist mine (bingo + blindtest):
  - [ ] legacy: playlist perso existante avant patch -> valid√©e par d√©faut, pas de bloc validation, CTA d√©mo/program OK
  - [ ] ajouter via URL playlist YouTube Music (`/playlist?list=...`)
  - [ ] v√©rifier contrainte mini 40 morceaux (refus si < 40)
  - [ ] v√©rifier import max 40 morceaux
  - [ ] apr√®s import (nouvelle playlist): fiche transitoire, CTA d√©mo/program absents, bloc validation visible entre m√©tas et contenu
  - [ ] si suspects > 0: message d√©di√© + bouton validation disabled
  - [ ] tenter validation avec 1 suspect restant -> refus backend + message erreur
  - [ ] modifier artiste/titre/url d‚Äôun morceau
  - [ ] v√©rifier que l‚Äô√©dition unitaire modifie la ligne cibl√©e (pas de nouvelle ligne)
  - [ ] v√©rifier que le lien est enregistr√© en `youtu.be/<id>`
  - [ ] v√©rifier qu‚Äôune ligne corrig√©e n‚Äôest plus marqu√©e `Douteux`
  - [ ] suspect_count=0 + pr√©nom + checkbox: validation OK, `flag_validated=1`, CTA r√©apparaissent
  - [ ] URL forc√©e script `program/demo` sur playlist non valid√©e -> refus backend explicite
  - [ ] r√©ordonner monter/descendre
  - [ ] retirer 1 morceau
  - [ ] rechargement fiche biblioth√®que: contenu conforme
  - [ ] apr√®s import: redirection fiche (pas √©diteur), message import visible
  - [ ] fiche remplie: bloc import absent
  - [ ] fiche vide: bloc import pr√©sent
  - [ ] fiche vide: aucun titre section contenu / aucun placeholder
  - [ ] fiche vide: aucun bouton `Cr√©er mon jeu` / `D√©mo`
  - [ ] v√©rifier que les compteurs n‚Äôint√®grent pas les d√©mos
  - [ ] liste -> fiche -> retour: onglet `mine` conserv√©
  - [ ] liste -> fiche -> retour: onglet `cotton` conserv√©
  - [ ] liste -> fiche -> retour: onglet `community` conserv√©
  - [ ] playlist `mine` non valid√©e en liste: bouton unique `√Ä valider`, sans CTA `Cr√©er mon jeu`/`D√©mo`
  - [ ] fiche playlist: bouton modifier discret + ic√¥ne fine
  - [ ] √©dition morceau: labels visibles + sauvegarde OK
  - [ ] aper√ßu morceau: uniquement bouton `‚ñ∂ √âcouter 10s` (pas de `Support : Audio`, pas de lien YouTube visible)
  - [ ] mobile (390x844): les 3 cartes jeux tiennent sur 1 seule ligne au-dessus des onglets
  - [ ] view: bouton √©dition m√©tas = style `D√©mo` avec ic√¥ne seule
  - [ ] view: mode √©dition global via bouton unique pr√®s du titre (pas de lien `Modifier` unitaire par morceau)
  - [ ] suspect faux positif: clic `Valider` sans changer les champs retire bien la ligne du blocage
  - [ ] liens retour: hover/focus en blanc visible sur `view/create/edit/content`
- [ ] Robustesse UX/API:
  - [ ] submit ‚ÄúAjouter‚Äù ne redirige plus vers la liste biblioth√®que
  - [ ] aucun JSON brut affich√© si submit non-AJAX (fallback redirect vers √©diteur)
  - [ ] pas de faux positif (`success=true` avec `rows=[]`) sur ajout playlist
- [ ] Contr√¥les:
  - [ ] bouton `Modifier contenu` absent sur non-mine
  - [ ] URL forc√©e / POST forc√© non-mine refus√©s backend
  - [ ] `git diff --name-only` sans modif sous `pro/web/ec/modules/tunnel/start/*` ni `ec_start_*`

## Biblioth√®que ‚Äî verrou √©dition/suppression si contenu en cours d‚Äôutilisation

### Impl√©mentation
- [x] Rollback du patch versioning source:
  - [x] suppression des helpers/versioning auto-ensure (`status`, `archived_at`, `root_id`) dans la biblioth√®que
  - [x] suppression rotation archive/clone/new-id (m√©tas + contenu)
  - [x] suppression redirections UI vers nouvel ID (`p_theme_save.php`, `p_theme_content_ajax.php`)
  - [x] suppression filtres `published` inject√©s dans listing/s√©lection par ce patch
  - [x] suppression garde-fou `status` ajout√© dans start
  - [x] suppression bloc cron purge archives source
  - [x] migration `pro/web/ec/modules/jeux/bibliotheque/scripts/archive_versioning_migration.sql` neutralis√©e (legacy non utilis√©e par le flux courant)
- [x] Verrou m√©tier unique ‚Äúin use‚Äù:
  - [x] fonction backend de d√©tection usage sessions futures/en cours bas√©e sur les r√©f√©rences r√©elles:
    - [x] Quiz: `id_produit` + `lot_ids` (`id_type_produit IN (1,5)`)
    - [x] Bingo: `id_produit -> playlists_clients.id -> id_playlist` (`id_type_produit IN (3,6)`)
    - [x] Blindtest: `id_produit` direct (`id_type_produit=4`)
  - [x] filtre chronologie: `flag_session_demo=0`, `flag_configuration_complete=1`, `date>=CURDATE()`
  - [x] couverture des r√©f√©rences session communautaires:
    - [x] jointure `championnats_sessions.community_item_id -> community_items.id -> source_id`
    - [x] prise en compte dans les compteurs d‚Äôusage (fiche) et dans le verrou backend
  - [x] branch√© sur update/delete m√©ta + mutations de contenu (add/remove/move/update_item)
  - [x] code erreur m√©tier: `CONTENT_LOCKED_IN_USE`
  - [x] messages UI selon cas:
    - [x] usage par un autre client: blocage modification/suppression
    - [x] usage par le cr√©ateur uniquement: blocage + invitation √† supprimer sa session d‚Äôabord
- [x] Logs d‚Äô√©v√©nements backend:
  - [x] `CONTENT_EDIT_BLOCKED`
  - [x] `CONTENT_DELETE_BLOCKED`
  - [x] meta log: `content_type`, `content_id`, `reason`, `session_count`, `owner_session_count`, `other_client_session_count`
- [x] Communaut√©:
  - [x] sync mutation owner en update in-place (sans archive/new published)
  - [x] suppression owner autoris√©e => passage en `hidden` (pas d‚Äôarchivage)
  - [x] compat publication legacy conserv√©e en listing `community`:
    - [x] Quiz: visibilit√© si `id_etat=2`
    - [x] Playlists: visibilit√© si `online=1`
    - [x] appliqu√©e en OR avec la r√®gle courante `flag_validated=1 AND flag_share_community=1`
- [x] UX fiche (pr√©-check avant traitement):
  - [x] clic `Modifier` -> precheck AJAX backend, alerte imm√©diate si bloqu√©
  - [x] clic `Supprimer` -> precheck AJAX backend, alerte imm√©diate si bloqu√©, confirmation seulement si autoris√©
  - [x] clic `Modifier le contenu` (toggle √©dition in-page) -> precheck AJAX backend avant ouverture
- [x] UX fiche (acceptation du verrou):
  - [x] ajout d‚Äôun badge info ‚Äúen cours d‚Äôutilisation par X client(s)‚Äù sur la page `view` des contenus perso
  - [x] `X` bas√© sur le nombre de clients distincts en sessions futures/en cours hors d√©mo
  - [x] variante message si usage cr√©ateur uniquement: ‚Äúprogramm√©e dans ton agenda‚Äù + consigne suppression session
  - [x] en √©tat verrouill√©: masquage des boutons `Modifier`, `Supprimer`, `Modifier le contenu`
  - [x] compte admin biblioth√®que (`id_client=10`) :
    - [x] acc√®s modification/suppression/√©dition contenu sur th√©matiques communaut√© (`id_client_auteur>0`)
    - [x] owner-check bypass√© c√¥t√© backend (sources meta + content)
    - [x] verrou `CONTENT_LOCKED_IN_USE` conserv√©
    - [x] mode transition quiz legacy:
      - [x] √©largissement de l‚Äôonglet `Communaut√©` pour voir les s√©ries clients quiz legacy
      - [x] lev√©e du filtre `id_etat=2` en mode transition admin quiz (sinon liste vide sur historique non publi√©)
      - [x] action admin fiche: bascule `Publier en communaut√©` / `Retirer de la communaut√©`
      - [x] publication admin: sync DB (`flag_share_community`) + `community_items`
  - [x] m√©tas d‚Äôusage fiche owner ajust√©es:
    - [x] `Utilis√©e: 0 fois` -> `Jamais utilis√©e`
    - [x] `Derni√®re utilisation` masqu√©e si jamais utilis√©e
    - [x] `Utilis√©e` -> `Utilis√©e dans tes jeux` si usage perso > 0
    - [x] ajout `Playlist/S√©rie partag√©e: oui|non`
    - [x] ajout `Utilisation par la communaut√©: X fois` si partage actif et usages autres clients > 0

### Tests manuels minimum (verrou in_use)
- [ ] Contenu non utilis√©:
  - [ ] edit OK (impact direct)
  - [ ] delete OK (impact direct)
- [ ] Contenu utilis√© par session future/en cours:
  - [ ] edit refus√© avec `CONTENT_LOCKED_IN_USE` + message utilisateur
  - [ ] delete refus√© avec `CONTENT_LOCKED_IN_USE` + message utilisateur
- [ ] Fiche (pr√©-check UI):
  - [ ] clic `Modifier` sur contenu bloqu√©: alerte avant navigation
  - [ ] clic `Supprimer` sur contenu bloqu√©: alerte avant confirmation/submit
  - [ ] clic `Modifier le contenu` sur contenu bloqu√©: alerte avant ouverture de l‚Äô√©dition
- [ ] Fiche (badge usage):
  - [ ] sur contenu utilis√©: badge visible avec `X client(s)` coh√©rent
  - [ ] sur contenu non utilis√©: badge absent
  - [ ] contenu verrouill√©: boutons `Modifier`, `Supprimer`, `Modifier le contenu` masqu√©s

## References
- Audit preuve-first: `notes/audit-content-library-session-demo-2026-02-12.md`
- Canon repo: `canon/repos/pro/README.md`

## Done
- [x] 2026-02-12 ‚Äî Initialisation du canon `pro` (`README.md` + `TASKS.md`) avec cadrage content-library, tunnel start session/d√©mo, et r√©f√©rence d‚Äôaudit.
- [x] 2026-02-12 ‚Äî Impl√©mentation MVP Content Library (`pro/web/ec/modules/jeux/bibliotheque/*`) + routes `/extranet/games/library*` + menu EC + cha√Ænage `session_init`/`session_theme` pour Programmer/D√©mo.
- [x] 2026-02-12 ‚Äî MAJ audit/canon apr√®s ajout `pro/web/config.php` (bootstrap env confirm√©, inconnue #1 lev√©e dans la note d‚Äôaudit).
- [x] 2026-02-12 ‚Äî Biblioth√®que MVP: association et affichage images th√©matiques (list + fiche) via conventions upload existantes (`questions_lots` / `playlists`) avec fallback si absent.
- [x] 2026-02-12 ‚Äî Biblioth√®que MVP: affichage √©tablissement auteur en plus de l‚Äôauteur (`clients.nom` r√©solu via `id_client_auteur`) sur liste et fiche.
- [x] 2026-02-12 ‚Äî Affinage UI Biblioth√®que: s√©lecteur jeu visuel + couleurs dynamiques par jeu (onglet actif, bordure), filtre `Rubrique` contextuel sous onglets, actions directes en carte (`Cr√©er un jeu`/`Lancer une d√©mo`), lien d√©tail contextualis√©, niveau difficult√© affich√©.
- [x] 2026-02-13 ‚Äî Biblioth√®que: s√©curisation du flux ‚ÄúProgrammer une session‚Äù avec r√©introduction `step_2_setting`, transport `id_catalogue_produit` (`from=library`), auto-`session_theme` post-setting, validations tenant + compatibilit√© catalogue; flux d√©mo conserv√© sans `step_2_setting`.
- [x] 2026-02-13 ‚Äî Biblioth√®que Quiz: ajout du mode builder sur la liste (session `library_quiz_builder`, max 4), transport `quiz_lot_ids` vers `setting`, puis application multi-s√©ries c√¥t√© `session_setting` en r√©utilisant la logique tunnel start (`lot_ids`), avec validations serveur (droits/tenant/doublons/limite).
- [x] 2026-02-13 ‚Äî Biblioth√®que: it√©ration UX fiche (`view`) avec bloc caract√©ristiques align√© liste, d√©tail de contenu in-page (sans modale), mode builder Quiz depuis fiche, et extraits multim√©dias l√©gers (audio 10s, vid√©o courte, miniature image/Drive).
- [x] 2026-02-13 ‚Äî Biblioth√®que: CRUD mine-only metadata (create/edit) via √©crans d√©di√©s `editor/*` + adapter `sources/*` (Quiz `questions_lots`, Bingo/Blind `jeux_bingo_musical_playlists`) + garde owner backend, sans modification du tunnel start.
- [x] 2026-02-13 ‚Äî Biblioth√®que CRUD mine-only: ajout suppression owner-only depuis fiche (`content_library_theme_delete`), carte `+` contextualis√©e (libell√© + couleur jeu), pr√©filtrage jeu dans create (form sans select quand jeu d√©j√† fix√©), et hardening suppression anti-500 (fallback adapter + fallback URL + delete safe).
- [x] 2026-02-13 ‚Äî Biblioth√®que: √©dition contenu mine-only (Quiz s√©ries + Playlists) via nouvel √©cran `t_theme_content` et endpoint `content_library_theme_content_ajax`, avec adapters d√©di√©s `sources/*_content.php` (add/remove/move/update + owner-check), sans modification du tunnel start.
- [x] 2026-02-13 ‚Äî Biblioth√®que playlists: alignement contrat start/catalogue pour l‚Äôajout (URL playlist YouTube Music + import API, mini 40 / max 40), validation URL Music stricte, et correctifs runtime √©diteur contenu (AJAX headers, fallback non-AJAX, arr√™t redirections parasites, mapping liaison par `position`).
- [x] 2026-02-15 ‚Äî Biblioth√®que playlists: ajout du statut valid√©e/non valid√©e (schema minimal si absent), bloc ‚Äútitres douteux‚Äù post-import en fiche, redirection post-import vers la fiche, blocage UI+backend de Programmer/D√©mo tant que playlist perso non valid√©e, et action owner-only de validation manuelle.
- [x] 2026-02-15 ‚Äî Biblioth√®que playlists: finalisation workflow fiche (analyse/import depuis la fiche, √©dition unitaire inline), import en remplacement + 40 strict avec rollback, erreurs explicites AJAX, normalisation des liens `youtu.be`, correction mapping `map_id`, et update in-place des morceaux (sans cr√©ation de ligne).
- [x] 2026-02-16 ‚Äî Biblioth√®que playlists: validation obligatoire des nouvelles playlists perso avec migration legacy-safe (`flag_validated` d√©faut 1), bloc ‚ÄúValidation requise‚Äù en fiche (pr√©nom+waiver), mode backend `content_library_playlist_validate`, et blocage backend `program/demo` tant que non valid√©e.
- [x] 2026-02-18 ‚Äî Biblioth√®que UX list/view: CTA liste `mine` non valid√©e remplac√©s par `√Ä valider`, retour fiche->liste contextualis√© (onglet/rubrique/page), chips rubriques adoucis, bouton/ic√¥ne √©dition plus discrets, labels explicites en √©dition morceau, aper√ßu playlist compact `‚ñ∂ √âcouter 10s` sans lien YouTube en visu.
- [x] 2026-02-18 ‚Äî Biblioth√®que UX (it√©ration compl√©mentaire): switch jeux compact mobile sur une ligne, recadrage styles d‚Äôic√¥nes/liens (`D√©mo`/`D√©tail`), correction visibilit√© hover des liens de retour (blanc), et override manuel suspects (valider une ligne sans modification retire le suspect cibl√©).
- [x] 2026-02-18 ‚Äî Biblioth√®que Mine Quiz: patch minimal ‚Äúplaylist-like‚Äù (CTA header owner `Modifier` + `Supprimer` en fiche, lien `Modifier` question avec ic√¥ne, owner-only conserv√©).
- [x] 2026-02-18 ‚Äî Biblioth√®que Mine Quiz: √©tat interm√©diaire bas√© sur `countQuestions`, suppression du tag `Valide/Invalide`, bouton list `√Ä compl√©ter` tant que `<6`, puis validation officielle owner (pr√©nom+waiver) √† `6/6` avant activation des CTA `Cr√©er mon jeu`/`D√©mo` (list+view), avec reset auto de validation si la s√©rie repasse `<6`.
- [x] 2026-02-18 ‚Äî Biblioth√®que supports YouTube: saisie utilisateur en URL (`Lien YouTube Music` pour audio, `Lien YouTube` pour vid√©o), extraction auto serveur de l‚ÄôID et normalisation backend en `youtu.be/<id>`.
- [x] 2026-02-18 ‚Äî Quiz vid√©o: ajout champs facultatifs `D√©but`/`Fin` (ex: `30`, `1.30`) sur ajout/modif de question, avec message d‚Äôaide utilisateur; audio orient√© ‚ÄúTitre YouTube Music‚Äù (lien explicite vers music.youtube.com).
- [x] 2026-02-19 ‚Äî Biblioth√®que UX finalisation: builder Quiz ligne par ligne + drag/drop + retrait, filtres/supra-filtres recadr√©s (textes contextualis√©s, ligne d‚Äôaide blanche, d√©faut Cotton=`A la une`, Communaut√©/Perso=`Nouveaut√©s`), badge `Populaire` violet `#582AFF` avec √©toile, et simplification √©dition fiche mine via toggle global.
- [x] 2026-02-19 ‚Äî Biblioth√®que validation owner: bloc validation repositionn√© (entre m√©tas et contenu, fond warning), microcopies juridiques mises √† jour, pr√©nom auteur pr√©rempli depuis utilisateur actif, ordre des cases invers√©, et workflow suspects playlist (bloc validation masqu√© tant que suspects, √©dition auto-ouverte).
- [x] 2026-02-19 ‚Äî √âtape 1 partage communaut√©: wiring backend du choix UI de partage (`flag_share_community`) au moment de la validation owner, stockage DB (quiz + playlists) avec horodatage/version texte, et verrouillage post-validation du flag (non modifiable ensuite).
- [x] 2026-02-19 ‚Äî √âtape 2 communaut√©: publication automatique √† validation (`share=1`), sync `community_items` en update in-place (sans rotation archive/clone), suppression en `hidden`, stockage `community_item_id` en session (flows biblioth√®que `type=community`), et verrou backend `CONTENT_LOCKED_IN_USE` sur edit/delete source utilis√©s en sessions futures/en cours.
- [x] 2026-02-19 ‚Äî √âtape 3 legacy communaut√©: ajout du rebuild idempotent `rebuild_community_items_legacy.php` (origin `cotton`/`legacy_community`), et bascule des onglets Cotton/Communaut√© pour lister via `community_items` `published` uniquement.
- [x] 2026-02-19 ‚Äî √âtape 3bis legacy communaut√©: ajout du script SQL importable phpMyAdmin (`rebuild_community_items_legacy.sql`), fallback list automatique vers l‚Äôancienne logique si bootstrap `community_items` incomplet, puis verrouillage de la r√®gle Cotton sur `id_client_auteur = 0` (ID `10` reclass√© `legacy_community`).
- [x] 2026-02-20 ‚Äî Biblioth√®que view (Cotton/Communaut√©): ajout d‚Äôun bouton rouge de signalement √† c√¥t√© du titre `Contenu de la playlist/s√©rie`, ouverture d‚Äôune modale (motif + d√©tail conditionnel), et nouveau mode backend `content_library_report_issue` pour envoi d‚Äôun mail √† `contact@cotton-quiz.com` avec contexte contenu/utilisateur.
- [x] 2026-02-20 ‚Äî Biblioth√®que view (signalement UX): bouton de signalement d√©plac√© en bas du bloc contenu (pas dans le header), retour au style standard (non rouge), bouton modal `Annuler` contrast√©, et champ de pr√©cision toujours visible avec le libell√© `Pr√©cise les contenus qui posent probl√®me`.
- [x] 2026-02-20 ‚Äî Biblioth√®que signalement (fiabilisation envoi): bouton modal `Envoyer` align√© en style standard, et backend rec√¢bl√© sur la logique CRM contact (`crm_contact_ajouter`) pour d√©clencher l‚Äôemail admin via le circuit support existant; contenu enrichi avec exp√©diteur (nom/pr√©nom + compte client) et th√©matique concern√©e.
- [x] 2026-02-20 ‚Äî Biblioth√®que signalement (fix redirect): correction post-submit pour revenir syst√©matiquement sur la th√©matique signal√©e (`view` avec `type`) apr√®s envoi r√©ussi.
- [x] 2026-02-20 ‚Äî Biblioth√®que signalement (UX submit): abandon de la redirection post-envoi au profit d‚Äôun submit AJAX + modale de remerciement sur la page courante; backend enrichi d‚Äôune r√©ponse JSON d√©di√©e au mode `content_library_report_issue`, envoi mail conserv√© via logique directe (`mail_send`/fallback `mail`).
- [x] 2026-02-20 ‚Äî Biblioth√®que view (lisibilit√© contenu): boutons d‚Äôaper√ßu audio align√©s √† droite sur les lignes contenu (quiz + playlists), avec r√®gle responsive mobile (texte sur premi√®re ligne, aper√ßu align√© √† droite sur la suivante).
- [x] 2026-02-20 ‚Äî Biblioth√®que view (supports): alignement √† droite √©tendu √† tous les aper√ßus (audio, image, vid√©o, fallback lien/indisponible) avec conservation de la compatibilit√© mobile.
- [x] 2026-02-20 ‚Äî Biblioth√®que view (ajustement vid√©o): miniatures d‚Äôaper√ßu vid√©o (YouTube/fichier) r√©agrandies au format pr√©c√©dent (220px) avec conservation du responsive mobile.
- [x] 2026-02-20 ‚Äî Biblioth√®que view (ajustement UX vid√©o/mobile): mention ‚Äúles joueurs ne voient pas le titre de la vid√©o‚Äù restaur√©e sur les aper√ßus, et alignement mobile des supports forc√© √† gauche quand les √©l√©ments passent √† la ligne.
- [x] 2026-02-20 ‚Äî Biblioth√®que list (mobile): onglets source `Cotton / Communaut√© / Perso` maintenus sur une seule ligne via CSS responsive (`nowrap` + `flex:1` + r√©duction padding/typo).
- [x] 2026-02-20 ‚Äî Biblioth√®que list (mobile labels): libell√©s onglets raccourcis en mobile (`Cotton / Communaut√© / Mes playlists|s√©ries`) avec maintien des libell√©s complets en desktop.
- [x] 2026-02-20 ‚Äî Biblioth√®que view (signalement): garde d‚Äôaffichage renforc√© pour masquer le bouton sur les contenus perso (`$is_mine_item`) et le limiter strictement √† `Cotton/Communaut√©`.
- [x] 2026-02-20 ‚Äî Biblioth√®que create (perso): reprise du comportement tunnel start pour image par d√©faut √† la cr√©ation (`default_cotton_quiz.jpg` / `default_playlist.jpg` copi√©s vers `<id>.jpg`), avec fallback de chemin legacy.
- [x] 2026-02-20 ‚Äî Biblioth√®que view (m√©tas contenu): suppression du compteur √† droite du titre `Contenu de la playlist/s√©rie`, ajout des m√©tas `X morceaux|questions` et `Dur√©e indicative` (`30s * nb morceaux` pour playlist, `5 min` pour quiz), tout en conservant `x/6` uniquement pendant la cr√©ation d‚Äôune s√©rie quiz.
- [x] 2026-02-20 ‚Äî Biblioth√®que view (cr√©ation): affichage de `Dur√©e indicative` conditionn√© √† un contenu complet en mode perso (quiz: √† partir de `6` questions, playlist: contenu complet/validable), masqu√© pendant la phase incompl√®te.
- [x] 2026-02-20 ‚Äî Biblioth√®que view (cr√©ation): m√™me r√®gle appliqu√©e au m√©ta `Questions/Morceaux` (masqu√© tant que contenu incomplet), avec maintien du compteur de progression `x/6` dans le bloc contenu quiz.
- [x] 2026-02-20 ‚Äî Biblioth√®que view (m√©tas perso): tant que la th√©matique perso n‚Äôest pas valid√©e, masquage des lignes m√©ta `Playlist/S√©rie partag√©e`, `Questions/Morceaux` et `Dur√©e indicative`.
- [x] 2026-02-20 ‚Äî Biblioth√®que view (m√©tas): libell√© `Questions/Morceaux` harmonis√© en `Contenu` (`Contenu: X questions|morceaux`).
- [x] 2026-02-20 ‚Äî Biblioth√®que view (image): r√©duction de l‚Äôimage de t√™te en fiche (`max-height:220px`) avec conservation du ratio natif (`object-fit:contain`, sans recadrage).
- [x] 2026-02-20 ‚Äî Biblioth√®que view (image): alignement √† gauche de l‚Äôimage de t√™te (`margin-right:auto`, sans centrage).
- [x] 2026-02-20 ‚Äî Builder Quiz (view -> list): suppression de la modale depuis la fiche Quiz, CTA `Utiliser cette s√©rie` branch√© en ajout direct builder (`content_library_quiz_builder_add`) avec redirection liste `builder=1`; bloc builder liste mis √† jour (titre `Compose ton quiz (X / 4 s√©ries max.)`, sous-titre explicite 1..4 + cas `4/4` complet, CTA `Valider` + `Annuler` empil√©s et centr√©s verticalement).
